# Entity Data Model (Raw)

> Auto-derived from refined feature specifications.
> This file is incrementally updated as features are processed.

---

## 1. Entities

### 1.1 Brand

| Attribute   | Type         | Constraints                          | featureRefs       |
|-------------|--------------|--------------------------------------|-------------------|
| id          | UUID         | PK, auto-generated                   | [F-002]           |
| name        | VARCHAR      | NOT NULL, UNIQUE, maxlength 100; stored as plain text, sanitized on input (F-058) | [F-002, F-012, F-014, F-015, F-024, F-027, F-028, F-037, F-044, F-045, F-046, F-050, F-051, F-053, F-055, F-058] |
| logo_url    | TEXT         | NULLABLE; publicly accessible URL for brand logo from Supabase Storage | [F-012] |
| created_at  | TIMESTAMPTZ  | NOT NULL, auto-generated (default)   | [F-002]           |
| updated_at  | TIMESTAMPTZ  | auto-updated via trigger             | [F-002]           |

**featureRefs:** [F-002, F-003, F-009, F-010, F-012, F-013, F-014, F-015, F-018, F-024, F-027, F-028, F-037, F-044, F-045, F-046, F-050, F-051, F-053, F-055, F-058]

---

### 1.2 Phone

| Attribute      | Type              | Constraints                                        | featureRefs          |
|----------------|-------------------|----------------------------------------------------|----------------------|
| id             | UUID              | PK, auto-generated                                 | [F-002]              |
| brand_id       | UUID              | FK → Brand(id), NOT NULL                           | [F-002, F-009, F-010, F-013, F-014, F-015, F-018, F-023, F-024, F-027, F-028, F-037, F-046, F-050, F-051, F-053, F-055, F-057]|
| model          | VARCHAR           | NOT NULL, maxlength 150; stored as plain text, sanitized on input (F-058) | [F-002, F-009, F-010, F-013, F-014, F-018, F-023, F-024, F-028, F-037, F-044, F-045, F-051, F-053, F-055, F-058]|
| description    | TEXT              | NULLABLE, maxlength 5000; stored as plain text without HTML interpretation, sanitized on input (F-058) | [F-002, F-055, F-058]|
| storage_gb     | INTEGER           | NULLABLE                                           | [F-002, F-009, F-010, F-013, F-015, F-018, F-023, F-045, F-046, F-051, F-053]|
| ram_gb         | INTEGER           | NULLABLE                                           | [F-010, F-018, F-023, F-045, F-053]|
| color          | VARCHAR           | NULLABLE, maxlength 50; stored as plain text, sanitized on input (F-058) | [F-002, F-010, F-018, F-023, F-045, F-058]|
| condition      | PhoneCondition    | NOT NULL, ENUM ('new','used','refurbished')        | [F-002, F-009, F-010, F-013, F-015, F-018, F-023, F-028, F-037, F-045, F-046, F-051, F-053, F-055]|
| battery_health | INTEGER           | NULLABLE, CHECK (0–100); shown only when condition is 'used' or 'refurbished' | [F-010, F-018, F-023, F-045, F-053] |
| imei           | VARCHAR           | NULLABLE, UNIQUE, maxlength 20; stored as plain text, sanitized on input (F-058) | [F-010, F-023, F-045, F-058]|
| cost_price     | DECIMAL           | NOT NULL                                           | [F-002, F-009, F-010, F-023, F-024, F-026, F-045, F-054]|
| selling_price  | DECIMAL           | NOT NULL                                           | [F-002, F-009, F-010, F-013, F-015, F-016, F-018, F-023, F-025, F-026, F-028, F-037, F-045, F-046, F-051, F-053, F-054, F-055, F-057]|
| status         | PhoneStatus       | NOT NULL, ENUM ('available','sold','reserved')     | [F-002, F-009, F-010, F-013, F-018, F-023, F-025, F-026, F-027, F-041, F-045, F-050, F-055, F-057]|
| purchase_date  | DATE              | NULLABLE                                           | [F-010, F-045]       |
| supplier_id    | UUID              | FK → Supplier(id), NULLABLE                       | [F-010, F-023]       |
| notes          | TEXT              | NULLABLE, maxlength 2000; stored as plain text without HTML interpretation, sanitized on input (F-058) | [F-010, F-045, F-058]|
| created_at     | TIMESTAMPTZ       | NOT NULL, auto-generated (default)                 | [F-002, F-016, F-028, F-046, F-057]|
| updated_at     | TIMESTAMPTZ       | auto-updated via trigger                           | [F-002]              |

**featureRefs:** [F-002, F-003, F-009, F-010, F-013, F-014, F-015, F-016, F-017, F-018, F-023, F-024, F-025, F-026, F-027, F-028, F-034, F-037, F-041, F-044, F-045, F-046, F-050, F-051, F-053, F-054, F-055, F-057, F-058]

---

### 1.3 PhoneImage

| Attribute     | Type         | Constraints                                          | featureRefs          |
|---------------|--------------|------------------------------------------------------|----------------------|
| id            | UUID         | PK, auto-generated                                   | [F-002]              |
| phone_id      | UUID         | FK → Phone(id), NOT NULL, ON DELETE CASCADE          | [F-002, F-057]       |
| image_url     | TEXT         | NOT NULL; publicly accessible URL from Supabase Storage (phone-images bucket); used with Supabase image transformations for responsive srcset sizes and WebP format | [F-002, F-011, F-013, F-018, F-037, F-040, F-043, F-055]|
| storage_path  | TEXT         | NOT NULL; internal Supabase Storage bucket path (phone-images bucket) for deletion | [F-011, F-040]|
| is_primary    | BOOLEAN      | NOT NULL, DEFAULT false; only one per phone; primary image loads first in detail gallery, thumbnails load lazily | [F-002, F-009, F-011, F-013, F-018, F-037, F-043, F-055]|
| display_order | INTEGER      | NOT NULL, DEFAULT 0; drag-to-reorder position; determines lazy-load order in detail gallery thumbnails | [F-011, F-018, F-043]|
| created_at    | TIMESTAMPTZ  | NOT NULL, auto-generated (default)                   | [F-002]              |

**featureRefs:** [F-002, F-003, F-009, F-011, F-013, F-018, F-037, F-040, F-043, F-055, F-057]

---

### 1.4 Supplier

| Attribute      | Type         | Constraints                          | featureRefs       |
|----------------|--------------|--------------------------------------|-------------------|
| id             | UUID         | PK, auto-generated                   | [F-002]           |
| name           | VARCHAR      | NOT NULL, maxlength 200; stored as plain text, sanitized on input (F-058) | [F-002, F-019, F-058] |
| contact_person | VARCHAR      | NULLABLE, maxlength 200; stored as plain text, sanitized on input (F-058) | [F-019, F-058]    |
| contact_email  | VARCHAR      | NULLABLE, maxlength 255; stored as plain text, sanitized on input (F-058) | [F-002, F-019, F-058] |
| contact_phone  | VARCHAR      | NULLABLE, maxlength 30; stored as plain text, sanitized on input (F-058) | [F-002, F-019, F-058] |
| address        | TEXT         | NULLABLE, maxlength 1000; stored as plain text without HTML interpretation, sanitized on input (F-058) | [F-002, F-019, F-058] |
| notes          | TEXT         | NULLABLE, maxlength 2000; stored as plain text without HTML interpretation, sanitized on input (F-058) | [F-019, F-058]    |
| created_at     | TIMESTAMPTZ  | NOT NULL, auto-generated (default)   | [F-002]           |
| updated_at     | TIMESTAMPTZ  | auto-updated via trigger             | [F-002]           |

**featureRefs:** [F-002, F-003, F-010, F-019, F-020, F-021, F-022, F-023, F-034, F-058]

---

### 1.5 PurchaseOrder

| Attribute     | Type                | Constraints                                        | featureRefs     |
|---------------|---------------------|----------------------------------------------------|-----------------|
| id            | UUID                | PK, auto-generated                                 | [F-002]         |
| po_number     | VARCHAR             | NOT NULL, UNIQUE; human-readable purchase order number (e.g., PO-0001) displayed in list view | [F-020] |
| supplier_id   | UUID                | FK → Supplier(id), NOT NULL, ON DELETE RESTRICT    | [F-002, F-020, F-021, F-022]  |
| order_date    | DATE                | NOT NULL                                           | [F-002, F-020, F-021, F-022]  |
| total_amount  | DECIMAL             | NOT NULL; auto-calculated as sum of (quantity × unit_cost) for all line items | [F-002, F-020, F-021, F-022]  |
| status        | PurchaseOrderStatus | NOT NULL, ENUM; color-coded in list: pending=orange, received=green, cancelled=red; defaults to 'pending' on creation; transitions from 'pending' to 'received' via Mark as Received workflow; transitions from 'pending' to 'cancelled' via Cancel Order workflow (irreversible, requires confirmation dialog) | [F-002, F-020, F-021, F-022, F-023, F-047]  |
| notes         | TEXT                | NULLABLE, maxlength 2000; stored as plain text without HTML interpretation, sanitized on input (F-058) | [F-002, F-021, F-022, F-058]  |
| created_at    | TIMESTAMPTZ         | NOT NULL, auto-generated (default)                 | [F-002]         |
| updated_at    | TIMESTAMPTZ         | auto-updated via trigger                           | [F-002]         |

**featureRefs:** [F-002, F-003, F-020, F-021, F-022, F-023, F-034, F-047, F-058]

---

### 1.6 PurchaseOrderItem

| Attribute         | Type        | Constraints                                          | featureRefs     |
|-------------------|-------------|------------------------------------------------------|-----------------|
| id                | UUID        | PK, auto-generated                                   | [F-002]         |
| purchase_order_id | UUID        | FK → PurchaseOrder(id), NOT NULL, ON DELETE CASCADE  | [F-002, F-021, F-022]  |
| brand             | VARCHAR     | NOT NULL, maxlength 100; brand name text field from PO line item form; pre-filled into phone record forms during receiving; stored as plain text, sanitized on input (F-058) | [F-021, F-022, F-023, F-058]  |
| model             | VARCHAR     | NOT NULL, maxlength 150; model name text field from PO line item form; pre-filled into phone record forms during receiving; stored as plain text, sanitized on input (F-058) | [F-021, F-022, F-023, F-058]  |
| quantity          | INTEGER     | NOT NULL, CHECK >= 1; validated on form to require at least 1; determines how many individual phone record forms are generated during receiving | [F-002, F-021, F-022, F-023]  |
| unit_cost         | DECIMAL     | NOT NULL; cost per unit in the PO line item; maps to Phone.cost_price during receiving | [F-002, F-021, F-022, F-023]  |
| created_at        | TIMESTAMPTZ | NOT NULL, auto-generated (default)                   | [F-002]         |

**featureRefs:** [F-002, F-003, F-021, F-022, F-023, F-058]

---

### 1.7 Sale

| Attribute    | Type        | Constraints                          | featureRefs |
|--------------|-------------|--------------------------------------|-------------|
| id           | UUID        | PK, auto-generated                   | [F-002]     |
| phone_id     | UUID        | FK → Phone(id), NOT NULL             | [F-002, F-024, F-025] |
| sale_date    | DATE        | NOT NULL; default sort descending in sales list; supports date range filtering; defaults to today in Mark as Sold dialog; used by dashboard date range selector to filter KPI cards and charts by selected period | [F-002, F-024, F-025, F-027, F-044, F-048, F-057] |
| sale_price   | DECIMAL     | NOT NULL; displayed in sales list and used to compute total revenue; pre-filled with Phone.selling_price in Mark as Sold dialog; aggregated for revenue KPI filtered by dashboard date range | [F-002, F-024, F-025, F-027, F-044, F-048] |
| cost_price   | DECIMAL     | NOT NULL; records the cost price at time of sale for profit calculation (sale_price - cost_price); avoids dependency on mutable Phone.cost_price; used in profit KPI filtered by dashboard date range | [F-024, F-044, F-048] |
| buyer_name   | VARCHAR     | NULLABLE, maxlength 200; buyer/customer name displayed in the sales list; collected in Mark as Sold dialog; stored as plain text, sanitized on input (F-058) | [F-002, F-024, F-025, F-044, F-058] |
| buyer_phone  | VARCHAR     | NULLABLE, maxlength 30; buyer's phone number collected in Mark as Sold dialog; stored as plain text, sanitized on input (F-058) | [F-025, F-058] |
| buyer_email  | VARCHAR     | NULLABLE, maxlength 255; buyer's email address collected in Mark as Sold dialog; stored as plain text, sanitized on input (F-058) | [F-025, F-044, F-058] |
| notes        | TEXT        | NULLABLE, maxlength 2000; stored as plain text without HTML interpretation, sanitized on input (F-058) | [F-002, F-025, F-058] |
| created_at   | TIMESTAMPTZ | NOT NULL, auto-generated (default)   | [F-002]     |
| updated_at   | TIMESTAMPTZ | auto-updated via trigger             | [F-002]     |

**featureRefs:** [F-002, F-003, F-024, F-025, F-026, F-027, F-044, F-048, F-057, F-058]

---

### 1.8 ContactMessage

| Attribute   | Type         | Constraints                          | featureRefs       |
|-------------|--------------|--------------------------------------|-------------------|
| id          | UUID         | PK, auto-generated                   | [F-002, F-031]    |
| name        | VARCHAR      | NOT NULL, maxlength 200; required field on public contact form; displayed as column in admin messages table; stored as plain text, sanitized on input (F-058) | [F-002, F-029, F-031, F-058] |
| email       | VARCHAR      | NOT NULL, maxlength 255; required field on public contact form, validated for email format; displayed as column in admin messages table; stored as plain text, sanitized on input (F-058) | [F-002, F-029, F-031, F-058] |
| phone       | VARCHAR      | NULLABLE, maxlength 30; optional phone number field on public contact form; displayed as column in admin messages table; stored as plain text, sanitized on input (F-058) | [F-029, F-031, F-058] |
| subject     | VARCHAR      | NULLABLE, maxlength 300; stored as plain text, sanitized on input (F-058) | [F-002, F-058]    |
| message     | TEXT         | NOT NULL, maxlength 5000; required field on public contact form; truncated to first 50 characters as preview in admin messages table, full text shown in expandable row; stored as plain text without HTML interpretation — `<script>` tags and HTML markup are not executed when displayed in admin messages view (F-058); rendered with proper escaping via Angular's built-in sanitization | [F-002, F-029, F-031, F-058] |
| is_read     | BOOLEAN      | NOT NULL, DEFAULT false; new submissions default to unread; toggled per message from admin messages table; unread count (is_read=false) displayed as badge in sidebar navigation; Supabase Realtime subscription monitors INSERT and UPDATE events on this table to live-update the unread count badge without polling | [F-002, F-029, F-031, F-052, F-057] |
| created_at  | TIMESTAMPTZ  | NOT NULL, auto-generated (default); default sort descending in admin messages table | [F-002, F-031]    |

**featureRefs:** [F-002, F-003, F-029, F-030, F-031, F-034, F-052, F-057, F-058]

---

### 1.9 StockAlertConfig

| Attribute                | Type        | Constraints                                                    | featureRefs |
|--------------------------|-------------|----------------------------------------------------------------|-------------|
| id                       | UUID        | PK, auto-generated                                             | [F-050]     |
| low_stock_threshold      | INTEGER     | NOT NULL, DEFAULT 5, CHECK >= 0; total available stock count below which a low-stock warning alert is displayed on the admin dashboard | [F-050] |
| enable_brand_zero_alert  | BOOLEAN     | NOT NULL, DEFAULT true; when true, displays a per-brand alert on the admin dashboard for any brand with zero available stock | [F-050] |
| created_at               | TIMESTAMPTZ | NOT NULL, auto-generated (default)                             | [F-050]     |
| updated_at               | TIMESTAMPTZ | auto-updated via trigger                                       | [F-050]     |

**featureRefs:** [F-050]

> **Note:** StockAlertConfig is a singleton configuration entity — only one row exists in the table. It stores the configurable thresholds used to compute stock alerts at query time on the admin dashboard. The alerts themselves (total stock below threshold, brand with zero stock) are computed dynamically by querying `Phone` records with `status='available'` and grouping by `Brand` — no alert records are persisted. Each alert includes a link to create a new purchase order (`/admin/purchase-orders/new`). Alerts are displayed prominently above the KPI cards on the dashboard.

---

## 2. Enumerations

### 2.1 PhoneCondition
| Value        | Description                  | featureRefs                |
|--------------|------------------------------|----------------------------|
| new          | Brand new phone; mapped to schema.org/NewCondition in JSON-LD structured data (F-055) | [F-002, F-009, F-010, F-013, F-015, F-018, F-023, F-028, F-045, F-046, F-051, F-053, F-055]|
| used         | Pre-owned / used phone; mapped to schema.org/UsedCondition in JSON-LD structured data (F-055) | [F-002, F-009, F-010, F-013, F-015, F-018, F-023, F-028, F-045, F-046, F-051, F-053, F-055]|
| refurbished  | Factory refurbished phone    | [F-002, F-009, F-010, F-013, F-015, F-018, F-023, F-028, F-045, F-046, F-051, F-053]|

**featureRefs:** [F-002, F-009, F-010, F-013, F-015, F-018, F-023, F-028, F-045, F-046, F-051, F-053, F-055]

---

### 2.2 PhoneStatus
| Value     | Description                        | featureRefs                |
|-----------|------------------------------------|----------------------------|
| available | Phone is available for purchase; default status for phones created via PO receiving workflow; can be set via quick action from inventory list; counted for low-stock and per-brand zero-stock dashboard alerts (F-050); mapped to schema.org/InStock for JSON-LD offers.availability (F-055) | [F-002, F-009, F-010, F-013, F-018, F-023, F-025, F-026, F-027, F-041, F-045, F-050, F-055]|
| sold      | Phone has been sold; set by Mark as Sold dialog (F-025); Mark as Sold quick action triggers the full sale dialog | [F-002, F-009, F-010, F-025, F-041, F-045]|
| reserved  | Phone is reserved for a customer; can be set via quick action from inventory list | [F-002, F-009, F-010, F-041, F-045]|

**featureRefs:** [F-002, F-009, F-010, F-013, F-018, F-023, F-025, F-026, F-027, F-041, F-045, F-050, F-055]

---

### 2.3 PurchaseOrderStatus
| Value     | Description                              | featureRefs     |
|-----------|------------------------------------------|-----------------|
| pending   | Order placed, awaiting fulfillment; displayed as orange tag in PO list; default status on PO creation. On detail page, 'Mark as Received' and 'Cancel' buttons are available. Mark as Received workflow transitions PO from this status to 'received'. Cancel Order workflow transitions PO from this status to 'cancelled' (irreversible, requires confirmation dialog) | [F-002, F-020, F-021, F-022, F-023, F-047]  |
| received  | Order received from supplier; displayed as green tag in PO list. On detail page, status change buttons are disabled/hidden (including 'Cancel' — not available for received POs). Set by Mark as Received workflow after all phone records are created | [F-002, F-020, F-022, F-023, F-047]  |
| cancelled | Order has been cancelled; displayed as red tag in PO list. On detail page, 'Mark as Received' and 'Cancel' buttons are disabled/hidden. Cancellation is irreversible — a cancelled PO cannot be received. Cancel action requires confirmation dialog explaining the action is irreversible (F-034, F-047) | [F-002, F-020, F-022, F-034, F-047]  |

**featureRefs:** [F-002, F-020, F-021, F-022, F-023, F-034, F-047]

---

### 2.4 UserRole

| Value         | Description                                      | featureRefs |
|---------------|--------------------------------------------------|-------------|
| anon          | Anonymous (unauthenticated) user                 | [F-003]     |
| authenticated | Authenticated admin user with full access        | [F-003, F-004] |

**featureRefs:** [F-003, F-004]

---

### 2.5 DashboardDateRange

| Value          | Description                                                   | featureRefs |
|----------------|---------------------------------------------------------------|-------------|
| this_month     | Filters dashboard data to the current calendar month          | [F-048]     |
| last_30_days   | Filters dashboard data to the last 30 days from today         | [F-048]     |
| this_quarter   | Filters dashboard data to the current calendar quarter        | [F-048]     |
| this_year      | Filters dashboard data to the current calendar year           | [F-048]     |
| all_time       | No date filtering; shows all historical data                  | [F-048]     |
| custom         | Admin selects a custom start and end date via date range picker | [F-048]     |

**featureRefs:** [F-048]

> **Note:** DashboardDateRange is a frontend-only enumeration (not stored in the database). It defines the preset options available in the dashboard date range selector UI component. The selected range is used to filter Supabase queries for KPI cards and charts at query time. Default selection is 'this_month' or 'all_time'.

---

### 2.6 ThemeMode

| Value | Description                                                        | featureRefs |
|-------|--------------------------------------------------------------------|-------------|
| light | Light theme — default PrimeNG light theme styles applied           | [F-056]     |
| dark  | Dark theme — PrimeNG dark theme styles applied                     | [F-056]     |

**featureRefs:** [F-056]

> **Note:** ThemeMode is a frontend-only enumeration (not stored in the database). It defines the two theme modes available via the header theme toggle. The selected mode is persisted in `localStorage` and restored on subsequent visits. On first visit, the system preference (`prefers-color-scheme`) determines the default. When the theme changes, all PrimeNG components, custom SCSS styles, and text contrast ratios update accordingly.

---

## 3. Relationships

| Relationship                          | Type        | Description                                                    | Constraints           | featureRefs     |
|---------------------------------------|-------------|----------------------------------------------------------------|-----------------------|-----------------|
| Brand → Phone                         | One-to-Many | A brand has many phones; each phone belongs to one brand       | FK brand_id           | [F-002, F-010, F-013, F-014, F-015, F-018, F-023, F-024, F-027, F-028, F-037, F-044, F-045, F-046, F-050, F-051, F-053, F-055]|
| Phone → PhoneImage                    | One-to-Many | A phone has many images; each image belongs to one phone       | FK phone_id, CASCADE DELETE | [F-002, F-011, F-013, F-018, F-037, F-043, F-055]|
| Phone → Supplier                      | Many-to-One | A phone can optionally reference a supplier via supplier_id; auto-set from PO's supplier during receiving workflow | FK supplier_id, NULLABLE | [F-010, F-023]      |
| Supplier → PurchaseOrder              | One-to-Many | A supplier has many purchase orders; each order belongs to one supplier | FK supplier_id, RESTRICT DELETE | [F-002, F-019, F-020, F-021, F-022, F-023] |
| PurchaseOrder → PurchaseOrderItem     | One-to-Many | A purchase order has many line items; each item belongs to one order. At least one line item is required per PO. Line items drive phone record generation during receiving workflow. | FK purchase_order_id, CASCADE DELETE | [F-002, F-021, F-022, F-023] |
| Phone → Sale                          | One-to-Many | A phone can have many sales records; sales list displays phone's brand name (via Brand FK) and model; Mark as Sold dialog creates a sale record and sets phone status to 'sold' | FK phone_id           | [F-002, F-024, F-025, F-027, F-044, F-048] |

---

## 4. Access Control Policies (RLS)

> Row Level Security policies defining per-table, per-role access. All policies use the Supabase `TO` clause to target the correct role (`anon` or `authenticated`). Where `auth.uid()` is used, it is wrapped in a `SELECT` subquery for caching optimization: `(select auth.uid())`.

### 4.1 Public Tables (Anonymous Read Access)

| Table          | Role          | SELECT | INSERT | UPDATE | DELETE | Notes                                          | featureRefs |
|----------------|---------------|--------|--------|--------|--------|-------------------------------------------------|-------------|
| phones         | anon          | YES    | NO     | NO     | NO     | Anonymous users can browse available phones     | [F-003]     |
| phones         | authenticated | YES    | YES    | YES    | YES    | Full CRUD for authenticated admin users; inventory CSV export in F-045 | [F-003, F-045] |
| phone_images   | anon          | YES    | NO     | NO     | NO     | Anonymous users can view phone images           | [F-003, F-011] |
| phone_images   | authenticated | YES    | YES    | YES    | YES    | Full CRUD for authenticated admin users         | [F-003, F-011] |
| brands         | anon          | YES    | NO     | NO     | NO     | Anonymous users can view brands                 | [F-003]     |
| brands         | authenticated | YES    | YES    | YES    | YES    | Full CRUD for authenticated admin users         | [F-003]     |

### 4.2 Contact Messages (Anonymous Insert Access)

| Table            | Role          | SELECT | INSERT | UPDATE | DELETE | Notes                                          | featureRefs |
|------------------|---------------|--------|--------|--------|--------|-------------------------------------------------|-------------|
| contact_messages | anon          | NO     | YES    | NO     | NO     | Anonymous users can submit contact messages without authentication; spam prevention via honeypot, client-side rate limiting, and optional reCAPTCHA v3 (F-030) | [F-003, F-029, F-030] |
| contact_messages | authenticated | YES    | YES    | YES    | YES    | Full CRUD for authenticated admin users; admin messages management with read/unread toggle and delete in F-031 | [F-003, F-031] |

### 4.3 Private Tables (Authenticated Only)

| Table                | Role          | SELECT | INSERT | UPDATE | DELETE | Notes                                          | featureRefs |
|----------------------|---------------|--------|--------|--------|--------|-------------------------------------------------|-------------|
| suppliers            | anon          | NO     | NO     | NO     | NO     | Invisible to anonymous users; zero rows returned| [F-003]     |
| suppliers            | authenticated | YES    | YES    | YES    | YES    | Full CRUD for authenticated admin users         | [F-003]     |
| purchase_orders      | anon          | NO     | NO     | NO     | NO     | Invisible to anonymous users; zero rows returned| [F-003]     |
| purchase_orders      | authenticated | YES    | YES    | YES    | YES    | Full CRUD for authenticated admin users         | [F-003]     |
| purchase_order_items | anon          | NO     | NO     | NO     | NO     | Invisible to anonymous users; zero rows returned| [F-003]     |
| purchase_order_items | authenticated | YES    | YES    | YES    | YES    | Full CRUD for authenticated admin users         | [F-003]     |
| sales                | anon          | NO     | NO     | NO     | NO     | Invisible to anonymous users; zero rows returned| [F-003]     |
| sales                | authenticated | YES    | YES    | YES    | YES    | Full CRUD for authenticated admin users; sales list with filtering in F-024; CSV export in F-044 | [F-003, F-024, F-044] |
| stock_alert_configs  | anon          | NO     | NO     | NO     | NO     | Invisible to anonymous users; zero rows returned| [F-050]     |
| stock_alert_configs  | authenticated | YES    | YES    | YES    | YES    | Full CRUD for authenticated admin users; configurable stock alert thresholds for dashboard alerts | [F-050] |

### 4.4 RLS Implementation Notes

- **RLS enabled** on all tables listed above.
- **Policy TO clause:** Each policy explicitly targets `anon` or `authenticated` role rather than relying solely on `auth.uid()` checks.
- **auth.uid() caching:** Where `auth.uid()` is referenced in policy expressions, it is wrapped as `(select auth.uid())` for query performance optimization.
- **Default deny:** Tables without an explicit `anon` policy return zero rows to anonymous users (no data leakage).
- **Auth dependency:** RLS policies rely on the authentication state managed by F-004 (SupabaseAuthService) to distinguish `anon` from `authenticated` roles.

**featureRefs:** [F-003, F-004]

---

## 5. Database Indexes

> Performance indexes on frequently queried columns. Indexes are created in Supabase database migrations to optimize filtering, sorting, joining, and RLS policy evaluation.

### 5.1 Phone Indexes

| Index Name                  | Table  | Column(s)      | Purpose                                                     | featureRefs |
|-----------------------------|--------|----------------|-------------------------------------------------------------|-------------|
| idx_phones_status           | phones | status         | Catalog filtering (status='available'), stock KPI queries, RLS policy evaluation | [F-057] |
| idx_phones_brand_id         | phones | brand_id       | Brand filter on catalog, brand-grouped stock queries, join optimization | [F-057] |
| idx_phones_selling_price    | phones | selling_price  | Price sorting (ASC/DESC) and price range filtering on catalog | [F-057] |
| idx_phones_created_at       | phones | created_at     | "Newest First" default sort on catalog, recently added phones dashboard query | [F-057] |

### 5.2 PhoneImage Indexes

| Index Name                    | Table        | Column(s) | Purpose                                               | featureRefs |
|-------------------------------|--------------|-----------|-------------------------------------------------------|-------------|
| idx_phone_images_phone_id     | phone_images | phone_id  | Join optimization for Phone → PhoneImage relationship (catalog cards, detail gallery) | [F-057] |

### 5.3 Sale Indexes

| Index Name              | Table | Column(s) | Purpose                                                       | featureRefs |
|-------------------------|-------|-----------|---------------------------------------------------------------|-------------|
| idx_sales_sale_date     | sales | sale_date | Date range filtering on sales list, dashboard charts monthly aggregation | [F-057] |

### 5.4 ContactMessage Indexes

| Index Name                        | Table            | Column(s) | Purpose                                             | featureRefs |
|-----------------------------------|------------------|-----------|-----------------------------------------------------|-------------|
| idx_contact_messages_is_read      | contact_messages | is_read   | Unread message count badge query (WHERE is_read=false) | [F-057] |

### 5.5 RLS Policy Indexes

> Columns referenced in RLS policy `USING` or `WITH CHECK` expressions that use `auth.uid()` should have appropriate indexes if row-level filtering on those columns occurs frequently. For this application, RLS policies primarily use role-based checks (`TO anon`/`TO authenticated`) rather than per-row `auth.uid()` comparisons, so no additional RLS-specific indexes are required beyond the column indexes listed above. The `auth.uid()` caching optimization (`(select auth.uid())`) further reduces index dependency for policy evaluation.

**featureRefs:** [F-057]

---

## 6. Storage Bucket Configuration

> Supabase Storage bucket definitions for file uploads. Each bucket has its own access policies, file constraints, and MIME type restrictions.

### 6.1 phone-images

| Property            | Value                                      | featureRefs |
|---------------------|--------------------------------------------|-------------|
| Bucket Name         | `phone-images`                             | [F-040]     |
| Access              | Public (read); Authenticated-only (upload) | [F-040]     |
| Max File Size       | 5 MB                                       | [F-040]     |
| Allowed MIME Types  | image/jpeg, image/png, image/webp          | [F-040]     |
| RLS – SELECT (read) | Public: anyone can read/download images via public URL | [F-040] |
| RLS – INSERT (upload) | Authenticated users only (requires valid auth session) | [F-040] |
| RLS – UPDATE        | Authenticated users only                   | [F-040]     |
| RLS – DELETE        | Authenticated users only                   | [F-040]     |
| Related Entity      | PhoneImage (image_url stores public URL, storage_path stores bucket path) | [F-040, F-011] |
| Image Transformations | Supabase image transformations used for responsive sizing (e.g., 300px thumbnails for catalog cards, full size for detail gallery) and WebP format preference | [F-043] |

**Notes:**
- Uploaded images are stored under the `phone-images` bucket with a structured path (e.g., `phone-images/{phone_id}/{filename}`).
- The public URL generated by Supabase Storage is stored in `PhoneImage.image_url` for catalog display.
- The internal storage path is stored in `PhoneImage.storage_path` for deletion operations.
- Client-side validation (file type and 5MB size limit) is enforced before upload (F-011); bucket-level constraints serve as a server-side safety net.
- Supabase Storage image transformations are used to request appropriately sized thumbnails (e.g., 300px for catalog cards, full size for detail gallery) and prefer WebP format when supported (F-043).

**featureRefs:** [F-011, F-040, F-043]

---

## 7. Feature → Entity Traceability Matrix

| Feature ID | Feature Name                              | Entities Derived |
|------------|-------------------------------------------|------------------|
| F-001      | Project Scaffolding and Configuration     | _(none — infrastructure/setup feature, no domain entities)_ |
| F-002      | Supabase Database Schema and Migrations   | Brand, Phone, PhoneImage, Supplier, PurchaseOrder, PurchaseOrderItem, Sale, ContactMessage |
| F-003      | Row Level Security (RLS) Policies         | _(no new entities — security/access control feature)_. Added RLS policies to all 8 existing entities. Added UserRole enumeration. |
| F-004      | Admin Authentication with Supabase Auth   | _(no new entities — authentication/infrastructure feature)_. Updated UserRole enumeration featureRefs. Updated RLS implementation notes with auth dependency. |
| F-005      | Route Guard for Admin Routes              | _(no new entities — client-side routing/authorization feature)_. Enforces Angular route-level access control for `/admin/*` routes using Supabase auth session. Depends on auth state from F-004 and UserRole enumeration. |
| F-006      | Application Routing Configuration         | _(no new entities — client-side routing/infrastructure feature)_. Configures all Angular routes: public (`/`, `/phone/:id`, `/contact`, `/about`), auth (`/auth/login`), and admin (`/admin/*`). Admin routes are lazy-loaded and protected by auth guard (F-005). Routes reference existing entities: Phone, Supplier, PurchaseOrder, Sale, ContactMessage. Includes 404/wildcard route handling. |
| F-007      | Public Layout with Header, Footer, and Navigation | _(no new entities — UI/layout feature)_. Creates a responsive public layout shell with header (shop logo/name), navigation links (Catalog, About, Contact), and footer (business info, copyright). Uses PrimeFlex grid for responsive behavior. Mobile navigation collapses into hamburger/sidebar menu. Semantic HTML elements (nav, header, footer) with ARIA labels. No new entities, attributes, relationships, or enumerations. References routes defined in F-006. |
| F-008      | Admin Layout with Sidebar Navigation | _(no new entities — UI/layout feature)_. Creates an admin layout shell with collapsible sidebar navigation containing links to Dashboard, Inventory, Purchase Orders, Suppliers, Sales, and Messages. Sidebar displays unread message count badge (uses existing `ContactMessage.is_read` attribute from F-002). Top bar shows logged-in admin user email and logout button (uses auth state from F-004). Mobile sidebar collapses to overlay/drawer. Active route highlighting. No new entities, attributes, relationships, or enumerations added. References existing entities: Phone, PurchaseOrder, Supplier, Sale, ContactMessage. References routes from F-006 and auth state from F-004. |
| F-009      | Phone Inventory CRUD - List View | _(no new entities — admin UI/CRUD feature)_. Implements PrimeNG Table-based inventory list with server-side lazy loading, sorting, and global search. Refined Phone entity pricing: replaced single `price` attribute with `cost_price` and `selling_price` (both DECIMAL, NOT NULL). Table columns reference existing attributes: brand (via Brand relationship), model, storage, condition (PhoneCondition enum), cost_price, selling_price, status (PhoneStatus enum with color-coded tags: available=green, sold=red, reserved=orange), and image thumbnail (via PhoneImage.is_primary). Bulk actions: "Mark as Sold" updates Phone.status to 'sold'; "Delete Selected" removes selected Phone records. Row-level edit navigates to `/admin/inventory/:id/edit`; delete triggers confirmation dialog. Updated featureRefs on: Phone, Brand, PhoneImage entities; PhoneCondition, PhoneStatus enumerations. |
| F-010      | Phone Inventory CRUD - Add/Edit Form | _(no new entities — admin UI/CRUD feature)_. Implements reactive form for adding/editing phone records. **Attribute refinements on Phone entity:** renamed `storage` (VARCHAR) to `storage_gb` (INTEGER) to match form field naming and numeric type; added 5 new attributes: `ram_gb` (INTEGER, NULLABLE), `battery_health` (INTEGER, NULLABLE, CHECK 0–100, conditionally shown for used/refurbished), `imei` (VARCHAR, NULLABLE, UNIQUE), `purchase_date` (DATE, NULLABLE), `supplier_id` (UUID, FK → Supplier, NULLABLE), and `notes` (TEXT, NULLABLE). **New relationship:** Phone → Supplier (Many-to-One via supplier_id, NULLABLE) — supplier dropdown lists all suppliers. Brand field uses autocomplete from Brand entity. Condition dropdown drives conditional visibility of battery_health. Form validates required fields (model, cost_price, selling_price) and numeric constraints (storage_gb, ram_gb, battery_health, cost_price, selling_price). Updated featureRefs on: Phone entity and attributes (brand_id, model, storage_gb, color, condition, cost_price, selling_price, status); Brand entity; Supplier entity; PhoneCondition, PhoneStatus enumerations; Brand → Phone relationship. |
| F-011      | Phone Image Upload and Management | _(no new entities — image upload/management feature)_. Implements multi-file image upload for phone records using Supabase Storage with drag-and-drop, preview thumbnails, concurrent upload with individual progress indicators, drag-to-reorder, set primary image, and delete functionality. **Attribute refinements on PhoneImage entity:** renamed `url` (TEXT) to `image_url` (TEXT, NOT NULL) to match acceptance criteria naming and clarify as the publicly accessible Supabase Storage URL; added `storage_path` (TEXT, NOT NULL) for internal Supabase Storage bucket path needed for deletion; added `display_order` (INTEGER, NOT NULL, DEFAULT 0) for drag-to-reorder position. Updated `is_primary` featureRefs to include [F-011] — "Set as Primary" sets is_primary=true for selected image and false for all others of the same phone. Validates file type (JPEG, PNG, WebP) and max file size (5MB) client-side before upload. Images stored in Supabase Storage bucket with public access policies. Updated featureRefs on: PhoneImage entity and attributes (image_url, storage_path, is_primary, display_order); Phone → PhoneImage relationship; phone_images RLS policies. |
| F-012      | Brand Management | _(no new entities — admin CRUD/directory management feature)_. Implements CRUD operations for the Brand entity with inline creation from the phone form and a dedicated management interface. **Attribute addition on Brand entity:** added `logo_url` (TEXT, NULLABLE) for optional brand logo upload displayed alongside brand name in catalog filters. Updated `name` attribute featureRefs to include [F-012] — uniqueness enforced at database level (UNIQUE constraint). Brands support inline creation from the phone form brand autocomplete field (when typed brand doesn't exist, option to create is presented). New brands appear immediately in filter dropdowns and autocomplete. Editing a brand name updates all UI references accordingly (via FK relationship). Updated featureRefs on: Brand entity and attributes (name, logo_url). |
| F-013      | Public Phone Catalog - Grid/List View | _(no new entities — public-facing UI/display feature)_. Implements the public phone catalog page showing only phones with `status='available'`. Supports grid and list view toggle using PrimeNG DataView or custom grid with PrimeFlex responsive classes (1 column mobile, 2 tablet, 3-4 desktop). Phone cards display: primary image (`PhoneImage.is_primary=true`, with placeholder fallback when no primary image exists), brand name (via Brand → Phone FK relationship), model, selling_price, condition tag (colored badge from PhoneCondition enum), and storage_gb. No new entities, attributes, relationships, or enumerations added. Updated featureRefs on: Phone entity and attributes (brand_id, model, storage_gb, condition, selling_price, status); Brand entity; PhoneImage entity and attributes (image_url, is_primary); PhoneCondition enumeration (all values); PhoneStatus enumeration (entity-level and `available` value); Brand → Phone relationship; Phone → PhoneImage relationship. |
| F-014      | Catalog Search | _(no new entities — public-facing UI/search feature)_. Implements a debounced (300ms) search bar on the public catalog page that filters phones by brand name (`Brand.name`) or model name (`Phone.model`). Search is case-insensitive and results update dynamically as the user types. Displays "No phones found" message with clear-filters suggestion when search yields no results. Clearing the search input restores all available phones. Operates on existing entities and attributes — no new entities, attributes, relationships, or enumerations added. Uses Brand → Phone FK relationship to resolve brand name for search matching. Updated featureRefs on: Brand entity and `Brand.name` attribute (added F-014); Phone entity and attributes `brand_id`, `model` (added F-014); Brand → Phone relationship (added F-014). |
| F-015      | Catalog Filters | _(no new entities — public-facing UI/filter feature)_. Implements catalog filter controls on the public catalog page: brand dropdown (populated from `Brand` entity via Brand → Phone FK), condition multi-select (`PhoneCondition` enum values: new, used, refurbished), storage capacity checkboxes/dropdown (`Phone.storage_gb`), and price range slider (`Phone.selling_price` min/max). Filters combine with AND logic and work alongside search (F-014). Active filters are visually indicated with tags/chips and a "Clear All Filters" button. URL query parameters update to allow sharing/bookmarking filtered views. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Brand entity (added F-015); Brand.name attribute (added F-015); Phone entity (added F-015); Phone.brand_id attribute (added F-015); Phone.storage_gb attribute (added F-015); Phone.condition attribute (added F-015); Phone.selling_price attribute (added F-015); PhoneCondition enumeration and all values (added F-015); Brand → Phone relationship (added F-015). |
| F-016      | Catalog Sorting | _(no new entities — public-facing UI/sorting feature)_. Implements sorting controls for the public catalog page with three options: "Newest First" (`Phone.created_at` DESC, default), "Price: Low to High" (`Phone.selling_price` ASC), and "Price: High to Low" (`Phone.selling_price` DESC). Sorting applies within filtered results (works alongside F-014 search and F-015 filters). Active sort option is visually indicated. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Phone entity (added F-016); Phone.created_at attribute (added F-016); Phone.selling_price attribute (added F-016). |
| F-017      | Catalog Pagination | _(no new entities — public-facing UI/pagination feature)_. Implements server-side pagination for the public phone catalog using PrimeNG Paginator and Supabase `.range()` queries. Supports configurable page size (e.g., 12, 24), page navigation controls, total record count display, and current page indicator. Paginator resets to page 1 when filter (F-015) or search (F-014) criteria change. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Phone entity (added F-017). |
| F-018      | Phone Detail Page | _(no new entities — public-facing UI/display feature)_. Implements the public phone detail page showing full specifications with PrimeNG Galleria image gallery (thumbnail navigation, ordered by `PhoneImage.display_order`), all phone specs (brand via Brand FK, model, storage_gb, ram_gb if not null, color if not null, condition), battery_health as visual progress bar (0-100%, conditionally shown for used/refurbished), prominently displayed selling_price, and availability status badge (from PhoneStatus enum). Includes WhatsApp inquiry button with pre-filled message containing brand, model, and storage_gb. Back-to-catalog link preserves previous filter/search state. Displays "Phone not found" for non-existent or unavailable phone_id. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Phone entity and attributes (brand_id, model, storage_gb, ram_gb, color, condition, battery_health, selling_price, status — added F-018); Brand entity (added F-018); PhoneImage entity and attributes (image_url, is_primary, display_order — added F-018); PhoneCondition enumeration (all values — added F-018); PhoneStatus enumeration (entity-level and `available` value — added F-018); Brand → Phone relationship (added F-018); Phone → PhoneImage relationship (added F-018). |
| F-019      | Supplier Management CRUD | _(no new entities — admin CRUD feature)_. Implements full CRUD for suppliers with PrimeNG Table list view (name, contact_person, phone, email, action columns) and reactive add/edit form. **Attribute additions on Supplier entity:** added `contact_person` (VARCHAR, NULLABLE) for supplier contact person name; added `notes` (TEXT, NULLABLE) for free-text supplier notes. Updated featureRefs on existing Supplier attributes: `name` (required field, validated on form submit), `contact_email` (email column in list, email field in form), `contact_phone` (phone column in list, phone field in form), `address` (form field). Feature includes purchase order history view per supplier — leverages existing Supplier → PurchaseOrder (One-to-Many, RESTRICT DELETE) relationship. Delete prevention: when a supplier has existing purchase orders, delete is blocked with informative error message (enforced by ON DELETE RESTRICT FK constraint). Updated featureRefs on: Supplier entity and attributes (name, contact_person, contact_email, contact_phone, address, notes — added F-019); Supplier → PurchaseOrder relationship (added F-019). |
| F-020      | Purchase Order List and Filtering | _(no new entities — admin UI/list feature)_. Implements PrimeNG Table-based purchase order list view with columns: PO number, supplier name, order date, total amount, status (color-coded), and actions. **Attribute addition on PurchaseOrder entity:** added `po_number` (VARCHAR, NOT NULL, UNIQUE) for human-readable purchase order number displayed in the list view (e.g., PO-0001). Status is color-coded using PurchaseOrderStatus enum values: pending=orange, received=green, cancelled=red. Supports filtering by status (pending/received/cancelled) and by supplier (via Supplier → PurchaseOrder FK relationship). Default sort: order_date descending. Displays summary statistics at the top (computed aggregates — no data model impact). Each row has action buttons for viewing details and navigating to PO detail page. Updated featureRefs on: PurchaseOrder entity and attributes (po_number new, supplier_id, order_date, total_amount, status — added F-020); Supplier entity (added F-020, used as filter source and displayed column); PurchaseOrderStatus enumeration and all values (added F-020, color-coded display); Supplier → PurchaseOrder relationship (added F-020, supplier filter). |
| F-021      | Purchase Order Creation | _(no new entities — admin UI/form feature)_. Implements PO creation form with supplier dropdown, order date picker, dynamic line item rows (brand, model, quantity, unit_cost), auto-calculated line totals and PO total, and notes. **Attribute refinements on PurchaseOrderItem entity:** replaced `phone_id` (UUID, FK → Phone) with `brand` (VARCHAR, NOT NULL) and `model` (VARCHAR, NOT NULL) text fields to match PO line item form inputs; renamed `unit_price` (DECIMAL) to `unit_cost` (DECIMAL, NOT NULL) to align with feature specification naming. Updated `quantity` constraint from CHECK > 0 to CHECK >= 1 per validation acceptance criteria. **Removed relationship:** Phone → PurchaseOrderItem (no longer applicable — line items use text brand/model, not Phone FK). Updated `total_amount` constraint description to clarify auto-calculation as sum of (quantity × unit_cost) for all line items. PO status defaults to 'pending' on creation. Validation requires at least one line item per PO. Updated featureRefs on: PurchaseOrder entity and attributes (supplier_id, order_date, total_amount, status, notes — added F-021); PurchaseOrderItem entity and attributes (purchase_order_id, brand new, model new, quantity, unit_cost renamed — added F-021); Supplier entity (added F-021, supplier dropdown source); PurchaseOrderStatus enumeration `pending` value (added F-021, default on creation); Supplier → PurchaseOrder relationship (added F-021); PurchaseOrder → PurchaseOrderItem relationship (added F-021, at least one line item required). |
| F-022      | Purchase Order Detail View | _(no new entities — admin UI/detail view feature)_. Implements read-only PO detail page showing full PO header information (supplier details via Supplier FK, order_date, status, total_amount, notes) and a table of all line items (brand, model, quantity, unit_cost, calculated line total). Shows overall PO total. Includes action buttons for status changes: 'Mark as Received' and 'Cancel' buttons available when status is 'pending'; buttons disabled/hidden when status is 'received' or 'cancelled'. Link back to PO list. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: PurchaseOrder entity and attributes (supplier_id, order_date, total_amount, status, notes — added F-022); PurchaseOrderItem entity and attributes (purchase_order_id, brand, model, quantity, unit_cost — added F-022); Supplier entity (added F-022, supplier details displayed in PO header); PurchaseOrderStatus enumeration and all values (added F-022, status display and conditional action buttons); Supplier → PurchaseOrder relationship (added F-022); PurchaseOrder → PurchaseOrderItem relationship (added F-022, line items table). |
| F-023      | Purchase Order Receiving Workflow | _(no new entities — admin workflow feature)_. Implements the 'Mark as Received' workflow that transitions a PO from 'pending' to 'received' and creates individual Phone inventory records for each PurchaseOrderItem line item. For each line item with quantity=N, N individual phone record forms are generated, pre-filled with brand and model from the PO item. Admin enters per-unit details: color, IMEI, condition, battery_health, selling_price, storage_gb, ram_gb. On confirmation: PO status changes to 'received' (PurchaseOrderStatus enum), individual Phone records are created with status='available' (PhoneStatus enum), supplier_id auto-set from PO's supplier (Phone → Supplier relationship), and cost_price auto-set from PO item's unit_cost. Partial receiving is not supported in MVP — all items must be received at once. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Phone entity and attributes (brand_id, model, storage_gb, ram_gb, color, condition, battery_health, imei, cost_price, selling_price, status, supplier_id — added F-023); Supplier entity (added F-023, supplier_id auto-set on created phones); PurchaseOrder entity and attribute (status — added F-023, transitions from pending to received); PurchaseOrderItem entity and attributes (brand, model, quantity, unit_cost — added F-023, drive phone record generation and pre-fill); PhoneCondition enumeration and all values (added F-023, entered per phone during receiving); PhoneStatus enumeration and `available` value (added F-023, default for created phones); PurchaseOrderStatus enumeration and `pending`/`received` values (added F-023, workflow transition); Brand → Phone relationship (added F-023, brand resolved for created phones); Phone → Supplier relationship (added F-023, auto-set from PO); Supplier → PurchaseOrder relationship (added F-023, supplier linkage during receiving); PurchaseOrder → PurchaseOrderItem relationship (added F-023, line items drive phone generation). |
| F-024      | Sales Tracking List | _(no new entities — admin UI/list feature)_. Implements PrimeNG Table-based sales tracking page displaying: phone (brand + model via Phone → Brand FK), sale_price, cost_price, calculated profit (sale_price - cost_price, color-coded green/red), buyer_name, sale_date. Default sort: sale_date descending. Supports date range filtering (start/end date). Summary row displays: total revenue (sum of sale_price), total cost (sum of cost_price), total profit (sum of profits), average margin % ((total profit / total revenue) * 100) — all computed aggregates with no data model impact. Clicking phone name navigates to phone edit page. **Attribute changes on Sale entity:** added `cost_price` (DECIMAL, NOT NULL) to record cost price at time of sale for profit calculation (avoids dependency on mutable Phone.cost_price); renamed `customer_name` to `buyer_name` (VARCHAR, NULLABLE) to align with feature specification naming. Updated featureRefs on: Sale entity (added F-024) and attributes (phone_id, sale_date, sale_price, cost_price new, buyer_name renamed); Phone entity (added F-024) and attributes (brand_id, model, cost_price — phone info and cost source displayed in sales list); Brand entity (added F-024) and attribute (name — brand name displayed in sales list via Phone → Brand FK); Phone → Sale relationship (added F-024 — sales list resolves phone info); Brand → Phone relationship (added F-024 — brand name resolved transitively for sales list display); sales RLS policy authenticated role (added F-024). |
| F-025      | Mark as Sold Dialog | _(no new entities — admin UI/workflow feature)_. Implements a 'Mark as Sold' dialog triggered from the inventory list that creates a sales record and updates phone status to 'sold'. **Attribute additions on Sale entity:** added `buyer_phone` (VARCHAR, NULLABLE) for buyer's phone number; added `buyer_email` (VARCHAR, NULLABLE) for buyer's email address — both collected in the Mark as Sold dialog form. Updated existing Sale attributes: `sale_price` is pre-filled with `Phone.selling_price`; `sale_date` defaults to today; `buyer_name`, `notes` are optional dialog fields. On confirmation: creates Sale record (via Phone → Sale relationship) and updates `Phone.status` to 'sold' (PhoneStatus enum). Phone with status 'sold' no longer appears in public catalog (status no longer 'available'). Updated featureRefs on: Phone entity (added F-025) and attributes (selling_price — pre-fills sale_price, status — updated to 'sold'); Sale entity (added F-025) and attributes (phone_id, sale_date, sale_price, buyer_name, buyer_phone new, buyer_email new, notes); PhoneStatus enumeration (added F-025) and values (available, sold — status transition); Phone → Sale relationship (added F-025 — dialog creates sale record). |
| F-026      | Admin Dashboard with KPI Cards | _(no new entities — admin dashboard/analytics feature)_. Implements admin dashboard displaying 4 KPI cards computed from existing entities: Total Stock (count of phones with `Phone.status='available'`), Stock Value (sum of `Phone.cost_price` for available phones), Potential Profit (sum of `Phone.selling_price - Phone.cost_price` for available phones), Total Sales (count of `Sale` records). All KPIs are computed aggregates at query time — no new entities, attributes, relationships, or enumerations added. KPIs refresh on data changes. Updated featureRefs on: Phone entity (added F-026) and attributes (cost_price, selling_price, status — used in stock count, stock value, and potential profit calculations); Sale entity (added F-026 — total sales count); PhoneStatus enumeration and `available` value (added F-026 — filters phones for stock KPIs). |
| F-027      | Dashboard Charts | _(no new entities — admin dashboard/analytics visualization feature)_. Implements two PrimeNG Chart (Chart.js) dashboard charts: (1) Sales bar chart showing sales revenue per month for the current year — aggregates `Sale.sale_price` grouped by `Sale.sale_date` month; displays meaningful empty state when no sales data exists. (2) Stock-by-brand doughnut chart showing count of available phones per brand — counts `Phone` records where `status='available'` grouped by `Brand.name` via `Phone.brand_id` FK. Both charts are responsive and use the application's color theme. All data is computed as aggregates at query time — no new entities, attributes, relationships, or enumerations added. Updated featureRefs on: Brand entity (added F-027) and attribute (name — doughnut chart segment labels); Phone entity (added F-027) and attributes (brand_id — groups phones by brand for doughnut chart, status — filters available phones for stock chart); Sale entity (added F-027) and attributes (sale_price — bar chart revenue values, sale_date — bar chart time-axis grouping); PhoneStatus enumeration and `available` value (added F-027 — filters phones for stock-by-brand chart); Brand → Phone relationship (added F-027 — resolves brand name for doughnut chart); Phone → Sale relationship (added F-027 — sale data for revenue bar chart). |
| F-028      | Dashboard Recently Added Phones Table | _(no new entities — admin dashboard/display feature)_. Displays a table on the admin dashboard showing the 5 most recently added phones ordered by `Phone.created_at` DESC with columns: brand (via Brand → Phone FK), model, condition (PhoneCondition enum), selling_price, and created_at (date added). Each row links to `/admin/inventory/:id/edit`. Gracefully handles fewer than 5 phones without error. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Brand entity (added F-028) and `name` attribute (added F-028 — brand column display); Phone entity (added F-028) and attributes (`brand_id` — resolves brand name, `model` — table column, `condition` — table column, `selling_price` — table column, `created_at` — ordering DESC and date added column); PhoneCondition enumeration and all values (added F-028 — condition column display); Brand → Phone relationship (added F-028 — resolves brand name for table rows). |
| F-029      | Contact Page with Business Info and Form | _(no new entities — public-facing UI/form feature)_. Implements the public contact page with a two-column layout: business information on the left (address, phone, email as clickable tel:/mailto: links, WhatsApp button opening wa.me) and a contact form on the right. Form fields: name (required), email (required, validated for email format), phone (optional), message (required). Form submissions are saved to `contact_messages` table with `is_read=false` without requiring authentication. Success message displayed and form cleared on successful submission. **Attribute addition on ContactMessage entity:** added `phone` (VARCHAR, NULLABLE) for optional phone number field on the contact form. Updated existing ContactMessage attributes: `name` (required field — added F-029), `email` (required field with format validation — added F-029), `message` (required field — added F-029), `is_read` (defaults to false on submission — added F-029). Updated contact_messages RLS policy for anon role (added F-029 — anonymous INSERT for form submissions). No new entities, relationships, or enumerations added. |
| F-030      | Contact Form Spam Prevention | _(no new entities — spam prevention/security feature)_. Implements multi-layered spam prevention for the public contact form: (1) honeypot hidden field invisible to humans via CSS — submissions with honeypot filled are silently rejected; (2) client-side rate limiting — max 3 submissions per 5 minutes, 4th attempt shows rate limit message; (3) optional reCAPTCHA v3 integration — invisible bot detection with server-side token validation. All mechanisms operate at the form/validation layer before database insert and do not require new persistent storage. Honeypot field is never persisted. Rate limiting uses client-side storage (e.g., localStorage). reCAPTCHA token is validated server-side but not stored. Legitimate users experience no friction or visible CAPTCHAs. No new entities, attributes, relationships, or enumerations added. Updated featureRefs on: ContactMessage entity (added F-030 — spam prevention guards its insert pathway); contact_messages RLS policy for anon role (added F-030 — spam prevention operates on the same anonymous INSERT pathway). |
| F-031      | Admin Messages Management | _(no new entities — admin UI/CRUD feature)_. Implements the admin messages page with PrimeNG Table displaying all contact_messages sorted by `created_at` descending. Table columns: name, email, phone, message preview (first 50 characters truncated), created_at date, and is_read status badge (read/unread). Expandable rows reveal full message text. Supports toggling `is_read` status per message (true↔false) and deleting messages with confirmation dialog. Sidebar navigation Messages link displays an unread count badge (count of `ContactMessage` records where `is_read=false`), which decrements/increments in real-time as messages are marked read/unread. No new entities, attributes, relationships, or enumerations added — operates entirely on existing ContactMessage entity. Updated featureRefs on: ContactMessage entity (added F-031) and attributes (id — row operations, name — table column, email — table column, phone — table column, message — truncated preview and expandable full text, is_read — toggle and sidebar badge count, created_at — default sort descending and date column); contact_messages RLS policy for authenticated role (added F-031 — admin SELECT, UPDATE for toggle, DELETE for message removal). |
| F-032      | About Us Page | _(no new entities — public-facing UI/static content feature)_. Implements a static About Us page at the `/about` route with business description, opening hours, and optionally a business image. Content is hardcoded or configurable (not database-driven). Uses the public layout shell (header + footer) from F-007. Responsive and readable on all device sizes using PrimeFlex responsive utilities. No new entities, attributes, relationships, or enumerations added — purely a presentational page rendering static business information. No database interaction required. References route `/about` defined in F-006 and public layout shell from F-007. |
| F-033      | Toast Notifications for User Feedback | _(no new entities — frontend UI/service infrastructure feature)_. Implements a global toast notification service using PrimeNG Toast for success, error, warning, and info messages across the application. Toasts provide user feedback for CRUD operations, form submissions, validation errors, and system messages. Auto-dismiss after configurable duration (3-5 seconds). Multiple toasts stack vertically without overlapping. Service is injectable and usable from any Angular component. Operates entirely at the Angular service/UI layer — toast messages are transient, not persisted to any database. No new entities, attributes, relationships, or enumerations added. No existing entity featureRefs updated — feature has no database interaction or data model impact. |
| F-034      | Confirmation Dialogs for Destructive Actions | _(no new entities — frontend UI/UX feature)_. Implements reusable confirmation dialogs using PrimeNG ConfirmDialog for all destructive actions: deleting phones (single and bulk), deleting suppliers, deleting messages, cancelling POs, and bulk operations. Dialogs display "Are you sure?" message with item details, "Confirm" and "Cancel" buttons, and bulk delete dialogs state the number of items to be deleted. Confirmation dialogs are transient UI elements — no new data is persisted. The feature guards existing destructive operations on Phone (delete), Supplier (delete), ContactMessage (delete), and PurchaseOrder (cancel → PurchaseOrderStatus 'cancelled'). No new entities, attributes, relationships, or enumerations added. Updated entity-level featureRefs on: Phone entity (added F-034 — single and bulk delete confirmation); Supplier entity (added F-034 — delete confirmation); ContactMessage entity (added F-034 — delete confirmation); PurchaseOrder entity (added F-034 — cancel confirmation); PurchaseOrderStatus enumeration and `cancelled` value (added F-034 — cancel PO action guarded by confirmation dialog). |
| F-035      | Loading States and Skeleton Screens | _(no new entities — frontend UI/UX feature)_. Implements loading indicators and skeleton screen placeholders throughout the application: PrimeNG Table loading spinner overlays during data fetches, skeleton card placeholders on the catalog page during loading, loading spinners on form submit buttons with disabled state to prevent double-submission, skeleton placeholders for dashboard KPI cards during data loading, and loading state clearance with error message display on API call failures. All loading states are transient UI states managed in Angular component properties (e.g., `isLoading: boolean`) — no data is persisted to any database entity. Skeleton screens and spinners are purely presentational placeholders that disappear once data is loaded or an error occurs. No new entities, attributes, relationships, or enumerations added. No existing entity featureRefs updated — feature has no database interaction or data model impact. |
| F-036      | Responsive Design - Mobile First | _(no new entities — frontend UI/CSS/layout feature)_. Ensures all pages and components follow a mobile-first responsive design approach using PrimeFlex breakpoints and SCSS media queries. Catalog uses 1/2/3-4 column grid progression across mobile/tablet/desktop viewports. Admin tables horizontally scroll on mobile with frozen action columns where applicable. Forms stack vertically on small screens. Navigation adapts with hamburger/drawer patterns for mobile viewports. All interactive elements maintain minimum 44x44 CSS pixel touch targets (WCAG 2.5.5). Content reflows without horizontal scrolling at 320px viewport (WCAG 1.4.10 Reflow). This feature is purely presentational CSS/layout — it describes how existing UI components render responsively, not what data they display. No new entities, attributes, relationships, or enumerations added. No existing entity featureRefs updated — feature has no database interaction or data model impact. |
| F-037      | SEO Meta Tags for Public Pages | _(no new entities — frontend SEO/meta tags feature)_. Implements dynamic meta tags (title, description, Open Graph, Twitter Card) for all public pages using Angular's Title and Meta services. Phone detail pages have unique meta tags constructed from existing entity attributes: brand name (`Brand.name` via Brand → Phone FK), model (`Phone.model`), selling price (`Phone.selling_price`), condition (`Phone.condition`), and primary image (`PhoneImage.image_url` where `PhoneImage.is_primary=true`) for og:image. Catalog and static pages (About, Contact) have appropriate default meta tags. Canonical URL meta tags are set per page derived from the route. All meta tag values are computed at runtime in the browser DOM `<head>` element — no new data is persisted. No new entities, attributes, relationships, or enumerations added. Updated featureRefs on: Brand entity (added F-037) and `name` attribute (added F-037 — used in page title and og:title); Phone entity (added F-037) and attributes (`model` — used in page title/description, `selling_price` — used in meta description, `condition` — used in meta description); PhoneImage entity (added F-037) and attributes (`image_url` — used in og:image tag, `is_primary` — selects primary image for og:image); Brand → Phone relationship (added F-037 — resolves brand name for phone detail meta tags); Phone → PhoneImage relationship (added F-037 — resolves primary image for og:image tag). |
| F-038      | Error Handling and Global Error Handler | _(no new entities — frontend infrastructure/error handling feature)_. Implements a global error handling strategy: Angular ErrorHandler for uncaught JavaScript exceptions (logged to console or future monitoring service), HTTP interceptor for Supabase API error responses (401 → redirect to login page, 403 → 'Permission denied' toast, 500 → generic 'Something went wrong' toast, network failure → 'Network error' toast), and a fallback error page for critical failures. Sensitive error details (stack traces, technical details) are only logged to the console, never displayed to end users. All error handling operates at the Angular application layer — errors are intercepted, logged, and surfaced via transient toast notifications (F-033) or page redirects. No error data is persisted to any database entity. The 401 redirect leverages auth session state managed by F-004. No new entities, attributes, relationships, or enumerations added. No existing entity featureRefs updated — feature has no database interaction or data model impact. |
| F-039      | Google Maps Embed on Contact Page | _(no new entities — public-facing UI/presentational feature)_. Embeds a Google Maps iframe on the contact page (F-029) showing the shop's physical location. The iframe uses `loading="lazy"` to defer loading until scrolled into view, avoiding impact on initial page load performance. The map is responsive and fits within its container on all screen sizes. A fallback text address is displayed if the map cannot load (e.g., blocked by browser extension or network issue). The map embed URL/coordinates and fallback address are static configuration values (hardcoded or environment-based), not stored in any database entity. No new entities, attributes, relationships, or enumerations added. No existing entity featureRefs updated — feature has no database interaction or data model impact. |
| F-040      | Supabase Storage Bucket Configuration | _(no new entities — storage infrastructure/configuration feature)_. Configures a `phone-images` Supabase Storage bucket for phone image uploads. Bucket is public for read access (images accessible via public URL) and restricted to authenticated users for uploads via Storage RLS policies. File size limited to 5MB maximum. Allowed MIME types: image/jpeg, image/png, image/webp. Public URLs generated from this bucket are stored in `PhoneImage.image_url`; internal bucket paths are stored in `PhoneImage.storage_path`. Added Storage Bucket Configuration section (Section 5) documenting bucket properties, access policies, MIME type restrictions, and file size limits. No new entities, relationships, or enumerations added. Updated featureRefs on: PhoneImage entity (added F-040) and attributes (`image_url` — public URL from phone-images bucket, `storage_path` — internal bucket path). |
| F-041      | Inventory Status Quick Actions | _(no new entities — admin UI/workflow feature)_. Implements quick status change actions in the inventory list: Mark as Available, Mark as Reserved, and Mark as Sold (triggers full sale dialog from F-025). These allow rapid status changes without navigating to the edit form. Status changes update `Phone.status` (PhoneStatus enum) directly: 'Mark as Available' sets status to 'available', 'Mark as Reserved' sets status to 'reserved', both with immediate confirmation toast. 'Mark as Sold' opens the full Mark as Sold dialog (F-025) which creates a Sale record and sets status to 'sold'. Table row status tag updates in real-time without full page reload. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Phone entity (added F-041) and attribute (`status` — quick actions change phone status); PhoneStatus enumeration and all values: `available` (added F-041 — set via quick action), `sold` (added F-041 — triggers F-025 sale dialog), `reserved` (added F-041 — set via quick action). |
| F-042      | Keyboard Accessibility and Focus Management | _(no new entities — frontend accessibility/UX feature)_. Ensures all interactive elements (buttons, links, inputs) are keyboard-accessible via Tab key navigation with visible focus indicators (outline or ring) per WCAG 2.4.7. Dialogs trap focus within their boundaries and return focus to the triggering element on close. Forms support full tab navigation. PrimeNG components are augmented with proper ARIA attributes (role, aria-label, aria-expanded) where defaults are insufficient. Catalog phone cards are keyboard-navigable and activatable via Enter/Space. Meets WCAG 2.1 AA requirements for keyboard navigation. All requirements are purely frontend HTML/CSS/Angular accessibility concerns — focus styles, ARIA attributes, keyboard event handlers, and focus management logic. No data is stored, queried, or modeled. No new entities, attributes, relationships, or enumerations added. No existing entity featureRefs updated — feature has no database interaction or data model impact. |
| F-043      | Image Optimization and Lazy Loading | _(no new entities — frontend image optimization/performance feature)_. Implements image optimization for catalog and phone detail pages: lazy loading of off-screen images using native `loading='lazy'` attribute, responsive image sizes via `srcset` using Supabase Storage image transformations (e.g., 300px for catalog cards, full size for detail gallery), WebP format preference when supported by Supabase image transformations, placeholder/blur-up effect during image load, and width/height attributes to prevent Cumulative Layout Shift (CLS). Primary full-size image loads first on phone detail gallery while thumbnails load lazily. Styled placeholder displayed for phones with no images. No new entities, attributes, relationships, or enumerations added — operates entirely on existing PhoneImage entity attributes (`image_url` for constructing transformed URLs, `is_primary` for load priority, `display_order` for thumbnail ordering) and Phone → PhoneImage relationship. Updated featureRefs on: PhoneImage entity (added F-043) and attributes (`image_url` — used with Supabase image transforms for srcset and WebP, `is_primary` — primary image loads first in detail gallery, `display_order` — determines lazy-load order for thumbnails); Phone → PhoneImage relationship (added F-043 — fetches images for catalog cards and detail gallery); phone-images Storage Bucket Configuration (added F-043 — image transformations for responsive sizing and WebP format). |
| F-044      | Export Sales Data to CSV | _(no new entities — admin UI/export feature)_. Allows admin to export sales data to CSV format for external analysis or accounting. Export is generated client-side from the current dataset and respects active date range filters. CSV includes columns: phone brand (`Brand.name` via Phone → Brand FK), model (`Phone.model` via Sale → Phone FK), sale_price (`Sale.sale_price`), cost_price (`Sale.cost_price`), profit (computed: sale_price - cost_price), buyer_name (`Sale.buyer_name`), buyer_email (`Sale.buyer_email`), sale_date (`Sale.sale_date`). Downloaded file has a timestamped filename. Profit column is computed client-side — no data model impact. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Brand entity (added F-044) and `name` attribute (added F-044 — phone brand column in CSV export); Phone entity (added F-044) and `model` attribute (added F-044 — model column in CSV export); Sale entity (added F-044) and attributes (`sale_date` — CSV column and date range filter, `sale_price` — CSV column, `cost_price` — CSV column, `buyer_name` — CSV column, `buyer_email` — CSV column); Brand → Phone relationship (added F-044 — resolves brand name for CSV export); Phone → Sale relationship (added F-044 — resolves phone info for CSV export); sales RLS policy authenticated role (added F-044 — data access for export). |
| F-045      | Export Inventory Data to CSV | _(no new entities — admin UI/export feature)_. Allows admin to export the full inventory list to CSV format. Export is generated client-side from the current dataset and respects active search/filter criteria from the inventory list page. CSV includes all phone columns: brand (`Brand.name` via Brand → Phone FK), model (`Phone.model`), storage (`Phone.storage_gb`), ram (`Phone.ram_gb`), color (`Phone.color`), condition (`Phone.condition` — PhoneCondition enum), battery_health (`Phone.battery_health`), cost_price (`Phone.cost_price`), selling_price (`Phone.selling_price`), status (`Phone.status` — PhoneStatus enum), purchase_date (`Phone.purchase_date`). IMEI (`Phone.imei`) and notes (`Phone.notes`) are sensitive data included only for authenticated admin users. Downloaded file is useful for reporting and backup purposes. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Brand entity (added F-045) and `name` attribute (added F-045 — brand column in CSV export); Phone entity (added F-045) and attributes (`model`, `storage_gb`, `ram_gb`, `color`, `condition`, `battery_health`, `imei`, `cost_price`, `selling_price`, `status`, `purchase_date`, `notes` — all CSV export columns); PhoneCondition enumeration and all values (added F-045 — condition column in CSV export); PhoneStatus enumeration and all values (added F-045 — status column in CSV export); Brand → Phone relationship (added F-045 — resolves brand name for CSV export); phones RLS policy authenticated role (added F-045 — data access for inventory export). |
| F-046      | Phone Catalog URL State Management | _(no new entities — public-facing UI/URL state management feature)_. Persists catalog filter, search, sort, and pagination state in URL query parameters for bookmarking, sharing, and browser back/forward navigation. State is synchronized bidirectionally between the URL and UI controls. URL parameters map to existing entity attributes used by catalog features (F-014 search, F-015 filters, F-016 sorting, F-017 pagination): brand filter (`Brand.name` via Brand → Phone FK as `?brand=` parameter), condition filter (`Phone.condition` / PhoneCondition enum as `?condition=` parameter), storage filter (`Phone.storage_gb` as `?storage=` parameter), price range filter (`Phone.selling_price` as `?price_min=`/`?price_max=` parameters), sort option (`Phone.created_at` DESC for newest, `Phone.selling_price` ASC/DESC for price sorts as `?sort=` parameter), and pagination (`?page=` parameter). No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Brand entity (added F-046) and `name` attribute (added F-046 — brand filter URL parameter); Phone entity (added F-046) and attributes (`brand_id` — resolves brand for URL filter, `storage_gb` — storage filter URL parameter, `condition` — condition filter URL parameter, `selling_price` — price sort and price range URL parameters, `created_at` — newest-first sort URL parameter); PhoneCondition enumeration and all values (added F-046 — condition filter values in URL parameters); Brand → Phone relationship (added F-046 — resolves brand name for URL filter parameter). |

| F-047      | PO Cancellation Workflow | _(no new entities — admin workflow feature)_. Implements the ability to cancel a pending purchase order by transitioning `PurchaseOrder.status` from 'pending' to 'cancelled' via the PurchaseOrderStatus enum. Cancellation is irreversible — a cancelled PO cannot be received. Cancellation requires a confirmation dialog explaining that the action is irreversible. Cancelled POs show a red status tag in the PO list. For cancelled POs, 'Mark as Received' and 'Cancel' buttons are disabled. For received POs, the 'Cancel' button is not available. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: PurchaseOrder entity (added F-047) and `status` attribute (added F-047 — pending→cancelled transition with irreversible confirmation); PurchaseOrderStatus enumeration (added F-047) and values: `pending` (added F-047 — source state for cancellation, 'Cancel' button available), `received` (added F-047 — 'Cancel' button not available), `cancelled` (added F-047 — target state, buttons disabled, red tag in list, irreversible). |

| F-048      | Dashboard Date Range Selector | _(no new entities — admin dashboard/analytics filtering feature)_. Adds a date range selector to the admin dashboard that filters KPI cards (total sales count, revenue) and the sales chart by the selected time period. Preset options: This Month, Last 30 Days, This Quarter, This Year, All Time, Custom (manual start/end date picker). Default selection is 'This Month' or 'All Time'. All filtering operates on existing `Sale.sale_date` attribute at query time — no new persistent storage required. Date range selection is transient component state. **New enumeration added:** DashboardDateRange (frontend-only, 6 values: this_month, last_30_days, this_quarter, this_year, all_time, custom) documenting the preset date range options available in the UI selector. Updated featureRefs on: Sale entity (added F-048) and attributes (`sale_date` — date range filter axis, `sale_price` — revenue KPI filtered by date range, `cost_price` — profit calculation filtered by date range); Phone → Sale relationship (added F-048 — sale data for date-filtered KPIs and charts). |

| F-049      | PWA Support - Offline Capable and Installable | _(no new entities — frontend infrastructure/PWA configuration feature)_. Converts the Angular application into a Progressive Web App using `@angular/pwa`. Includes: (1) Angular service worker (`ngsw-worker.js`) for caching static assets (JavaScript bundles, CSS, images) enabling offline access to previously viewed catalog pages; (2) web app manifest (`manifest.webmanifest`) with app name, icons (multiple sizes), theme color, background color, display mode (standalone), and start_url — enables 'Add to Home Screen' install prompt on mobile browsers; (3) offline fallback page displayed when the network is unavailable and the requested page is not in the service worker cache. The service worker caches static assets automatically on install and serves them from cache when the network is unavailable. Previously viewed public catalog pages (phones, phone detail) are accessible offline from the cache. The manifest and service worker are static configuration files generated by `@angular/pwa` schematics — no data is persisted to any database entity. Offline caching operates on existing public entities (Phone, Brand, PhoneImage) at the HTTP response layer without any data model changes. No new entities, attributes, relationships, or enumerations added. No existing entity featureRefs updated — feature has no database interaction or data model impact. |

| F-050      | Inventory Low Stock Alerts | StockAlertConfig _(new entity)_. Displays alerts on the admin dashboard when total available stock falls below a configurable threshold or when a specific brand has zero available stock. **New entity:** StockAlertConfig (singleton configuration with `low_stock_threshold` and `enable_brand_zero_alert` attributes). Alerts are computed dynamically at query time by counting `Phone` records with `status='available'` (total and grouped by `Brand` via `brand_id` FK). Each alert includes a link to create a new purchase order (`/admin/purchase-orders/new`). Alerts are displayed prominently above KPI cards on the dashboard. Updated featureRefs on: Brand entity and `name` attribute (added F-050 — per-brand zero-stock alert labels); Phone entity and attributes (`brand_id` — groups phones by brand for per-brand alerts, `status` — filters available phones for stock counting); PhoneStatus enumeration and `available` value (added F-050 — filters phones for stock alert computation); Brand → Phone relationship (added F-050 — resolves brand for per-brand stock grouping). Added RLS policies for `stock_alert_configs` table (anon: no access; authenticated: full CRUD). |

| F-051      | Print Phone Label / Price Tag | _(no new entities — admin UI/print feature)_. Generates a printable price tag or label for a phone using CSS print media queries. Label displays: brand name (`Brand.name` via Brand → Phone FK), model (`Phone.model`), storage_gb (`Phone.storage_gb`), condition (`Phone.condition` — PhoneCondition enum), and selling_price (`Phone.selling_price`). Optionally includes a QR code linking to `/phone/:id`. Output formatted to fit standard label paper sizes via CSS `@media print` queries. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Brand entity (added F-051) and `name` attribute (added F-051 — brand name on label); Phone entity (added F-051) and attributes (`brand_id` — resolves brand name for label, `model` — label field, `storage_gb` — label field, `condition` — label field with PhoneCondition enum, `selling_price` — label price display); PhoneCondition enumeration and all values (added F-051 — condition displayed on label); Brand → Phone relationship (added F-051 — resolves brand name for label display). |

| F-052      | Supabase Realtime for Unread Message Count | _(no new entities — frontend real-time subscription feature)_. Uses Supabase Realtime subscriptions to live-update the unread message count badge in the admin sidebar whenever a new contact message is submitted (INSERT on `contact_messages`) or a message is marked as read/unread (UPDATE on `ContactMessage.is_read`). Subscription is established on admin login and cleaned up on logout. Automatic reconnection on network interruption. Eliminates the need for polling or manual page refresh. No new entities, attributes, relationships, or enumerations added — operates entirely on existing `ContactMessage` entity and its `is_read` attribute. Updated featureRefs on: ContactMessage entity (added F-052 — Realtime subscription monitors this table for INSERT and UPDATE events); ContactMessage.is_read attribute (added F-052 — unread count badge computation driven by real-time changes to this attribute). |
| F-053      | Phone Comparison Feature | _(no new entities — public-facing UI/comparison feature)_. Allows public visitors to select up to 3 phones for side-by-side comparison. A comparison view displays specs in aligned columns: brand name (`Brand.name` via Brand → Phone FK), model (`Phone.model`), storage (`Phone.storage_gb`), RAM (`Phone.ram_gb`), condition (`Phone.condition` — PhoneCondition enum), battery_health (`Phone.battery_health`), and price (`Phone.selling_price`). Selection state (up to 3 phones) persists during the browsing session using client-side storage (e.g., sessionStorage) — not persisted to any database entity. A floating comparison bar appears at the bottom when phones are selected, with a 'Compare' button opening the comparison page/dialog. Users are informed when the 3-phone maximum is reached. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Brand entity (added F-053) and `name` attribute (added F-053 — brand name displayed in comparison column); Phone entity (added F-053) and attributes (`brand_id` — resolves brand name for comparison display, `model` — comparison column, `storage_gb` — comparison column, `ram_gb` — comparison column, `condition` — comparison column with PhoneCondition enum, `battery_health` — comparison column, `selling_price` — comparison column as price); PhoneCondition enumeration and all values (added F-053 — condition displayed in comparison view); Brand → Phone relationship (added F-053 — resolves brand name for comparison columns). |
| F-054      | Inventory Profit Margin Indicators | _(no new entities — admin UI/display feature)_. Displays a computed profit margin percentage for each phone in the inventory list, calculated as `((selling_price - cost_price) / selling_price * 100)`. Margin is color-coded: red (below 10%), yellow/orange (10%–25%), green (above 25%). The margin column is sortable to quickly find lowest/highest margin items. Margin is computed at display time from existing `Phone.cost_price` and `Phone.selling_price` attributes — no new persistent storage required. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Phone entity (added F-054) and attributes (`cost_price` — used in margin calculation, `selling_price` — used in margin calculation). |
| F-055      | Structured Data (JSON-LD) for Phone Detail Pages | _(no new entities — frontend SEO/structured data feature)_. Adds JSON-LD structured data (schema.org Product type) to phone detail pages for enhanced search engine rich snippets. The JSON-LD script tag is generated at runtime in the browser from existing entity attributes: product name constructed from `Brand.name` + `Phone.model` (via Brand → Phone FK), `Phone.description` for product description, `Phone.selling_price` for `offers.price`, `Phone.status` for `offers.availability` (available→InStock), `Phone.condition` for `itemCondition` (new→schema.org/NewCondition, used→schema.org/UsedCondition), `Brand.name` for `brand.name`, and `PhoneImage.image_url` (where `PhoneImage.is_primary=true`) for `image`. Structured data must pass Google's Rich Results Test validation. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Brand entity (added F-055) and `name` attribute (added F-055 — JSON-LD product name and brand.name); Phone entity (added F-055) and attributes (`model` — JSON-LD product name, `description` — JSON-LD description, `selling_price` — JSON-LD offers.price, `condition` — JSON-LD itemCondition mapping, `status` — JSON-LD offers.availability mapping); PhoneImage entity (added F-055) and attributes (`image_url` — JSON-LD image, `is_primary` — selects primary image for JSON-LD); PhoneCondition enumeration and values `new` (added F-055 — mapped to NewCondition), `used` (added F-055 — mapped to UsedCondition); PhoneStatus enumeration and `available` value (added F-055 — mapped to InStock); Brand → Phone relationship (added F-055 — resolves brand name for JSON-LD); Phone → PhoneImage relationship (added F-055 — resolves primary image for JSON-LD). |
| F-056      | Dark Mode / Theme Toggle | _(no new entities — frontend UI/theming feature)_. Implements a theme toggle in the header that switches between light and dark mode using PrimeNG's theming system. User preference is persisted in `localStorage` (client-side) and restored on subsequent visits. On first visit, the system preference (`prefers-color-scheme` CSS media query) determines the default theme. When the theme switches, all PrimeNG components, custom SCSS styles, and text contrast ratios update correctly. **New enumeration added:** ThemeMode (Section 2.6) — a frontend-only enumeration with 2 values (light, dark) documenting the available theme modes. Theme state is entirely client-side (`localStorage` + Angular service) — no database entities, attributes, or relationships are involved. No existing entity featureRefs updated — feature has no database interaction or data model impact. |
| F-057      | Supabase Database Indexes for Performance | _(no new entities — database performance/infrastructure feature)_. Creates database indexes on frequently queried columns to optimize filtering, sorting, and join performance. **New section added:** Database Indexes (Section 5) documenting 7 indexes across 4 tables: phones (4 indexes: status, brand_id, selling_price, created_at), phone_images (1 index: phone_id), sales (1 index: sale_date), contact_messages (1 index: is_read). Indexes support catalog filtering/sorting (F-013–F-016), join optimization for phone images (F-011, F-013, F-018), sales date filtering (F-024, F-048), and unread message count queries (F-031, F-052). RLS policies use role-based checks rather than per-row auth.uid() comparisons, so no additional RLS-specific indexes are needed beyond the column indexes. All indexes reference existing entity attributes — no new entities, attributes, relationships, or enumerations added. Updated featureRefs on: Phone entity (added F-057) and attributes (`status`, `brand_id`, `selling_price`, `created_at` — indexed columns); PhoneImage entity (added F-057) and `phone_id` attribute (indexed for join optimization); Sale entity (added F-057) and `sale_date` attribute (indexed for date filtering); ContactMessage entity (added F-057) and `is_read` attribute (indexed for unread count query). |
| F-058      | Input Sanitization and XSS Prevention | _(no new entities — security/validation feature)_. Ensures all user inputs are sanitized to prevent cross-site scripting (XSS) attacks. Angular's built-in DomSanitizer handles template binding sanitization; no `bypassSecurityTrust*` methods used unless absolutely necessary and documented. Server-side validation enforced via Supabase RLS and PostgreSQL constraints. **Constraint refinements on existing attributes:** added `maxlength` constraints to all user-input VARCHAR and TEXT fields across 7 entities (Brand, Phone, Supplier, PurchaseOrder, PurchaseOrderItem, Sale, ContactMessage). All notes and text fields (`Phone.notes`, `Phone.description`, `Supplier.notes`, `Supplier.address`, `PurchaseOrder.notes`, `Sale.notes`, `ContactMessage.message`, `ContactMessage.subject`) are explicitly stored as plain text without HTML interpretation. Contact form `message` field specifically prevents `<script>` tag execution when displayed in admin messages view via Angular's default output escaping. All text inputs have appropriate `maxlength` constraints enforced at both form validation and database constraint levels. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements by adding security constraints. Updated featureRefs on: Brand entity (added F-058) and `name` attribute (added F-058 — maxlength, sanitization); Phone entity (added F-058) and attributes (`model`, `description`, `color`, `imei`, `notes` — added F-058, maxlength and plain text storage constraints); Supplier entity (added F-058) and attributes (`name`, `contact_person`, `contact_email`, `contact_phone`, `address`, `notes` — added F-058, maxlength and sanitization); PurchaseOrder entity (added F-058) and `notes` attribute (added F-058 — maxlength, plain text storage); PurchaseOrderItem entity (added F-058) and attributes (`brand`, `model` — added F-058, maxlength and sanitization); Sale entity (added F-058) and attributes (`buyer_name`, `buyer_phone`, `buyer_email`, `notes` — added F-058, maxlength and sanitization); ContactMessage entity (added F-058) and attributes (`name`, `email`, `phone`, `subject`, `message` — added F-058, maxlength, plain text storage, XSS prevention). |
| F-059      | 404 Not Found Page | _(no new entities — public-facing UI/static page feature)_. Implements a user-friendly 404 page for unknown routes. Displays a clear "Page Not Found" message with a link/button to return to the home catalog page. Uses the public layout shell (header and footer) from F-007. The page is purely presentational with static content — no database queries, no entity attribute references, and no data persistence. Similar to F-032 (About Us Page) in that it renders static content within the public layout. The 404 route is already defined as a wildcard/catch-all route in F-006. No new entities, attributes, relationships, or enumerations added. No existing entity featureRefs updated — feature has no database interaction or data model impact. |
| F-060      | Environment Configuration Management | _(no new entities — infrastructure/configuration feature)_. Sets up Angular environment configuration files (`environment.ts`, `environment.prod.ts`, `environment.example.ts`) for development and production builds. Supabase URL and anon key are stored in environment files as TypeScript constants. Build configurations in `angular.json` use `fileReplacements` to swap environment files for production builds. No secrets or service_role keys are included in client-side code. New developers can configure their environment by copying `environment.example.ts` and filling in values. All configuration values are static build-time constants stored in TypeScript files — not persisted to any database entity. No new entities, attributes, relationships, or enumerations added. No existing entity featureRefs updated — feature has no database interaction or data model impact. |

---

## 8. Change Log

| Date       | Feature  | Action                                                                                          |
|------------|----------|-------------------------------------------------------------------------------------------------|
| 2026-01-28 | F-001    | Processed feature. No domain entities, attributes, relationships, or enumerations extracted. Feature is infrastructure/setup only (Angular project init, Supabase SDK config, PrimeNG/PrimeFlex setup, SCSS theming, TypeScript strict mode, environment config). |
| 2026-01-28 | F-002    | Processed feature. Derived 8 entities: Brand, Phone, PhoneImage, Supplier, PurchaseOrder, PurchaseOrderItem, Sale, ContactMessage. Derived 3 enumerations: PhoneCondition (new, used, refurbished), PhoneStatus (available, sold, reserved), PurchaseOrderStatus (pending, received, cancelled). Derived 6 relationships with CASCADE and RESTRICT delete constraints. All tables use auto-generated UUIDs, timestamps, and update triggers. |
| 2026-01-28 | F-003    | Processed feature. No new entities derived — F-003 is a security/access control feature (RLS policies). Added Access Control Policies (RLS) section (Section 4) with per-table, per-role policy matrix covering all 8 existing entities. Added UserRole enumeration (anon, authenticated). Updated featureRefs on all 8 entities to include [F-003]. Documented RLS implementation notes: explicit TO clause role targeting, auth.uid() caching via SELECT subquery, default-deny for anonymous access. |
| 2026-01-28 | F-004    | Processed feature. No new entities derived — F-004 is an authentication/infrastructure feature (Supabase Auth email/password login, session persistence, reactive auth state, logout). Uses Supabase's managed `auth.users` table (not a custom entity). Updated UserRole enumeration `authenticated` value featureRefs to include [F-004]. Updated RLS Implementation Notes with auth dependency on F-004. No new entities, attributes, relationships, or enumerations added. |
| 2026-01-28 | F-005    | Processed feature. No new entities derived — F-005 is a client-side routing/authorization feature (Angular functional canActivate route guard for /admin/* routes). Checks Supabase auth session, redirects unauthenticated users to /auth/login with return URL preservation, handles session expiry on navigation. No new entities, attributes, relationships, or enumerations added. Feature depends on auth state managed by F-004 and UserRole enumeration (anon vs authenticated) defined in F-003. |
| 2026-01-28 | F-006    | Processed feature. No new entities derived — F-006 is a client-side routing/infrastructure feature (Angular route configuration). Defines all application routes: public routes (`/`, `/phone/:id`, `/contact`, `/about`), auth routes (`/auth/login`), and admin routes (`/admin`, `/admin/dashboard`, `/admin/inventory`, `/admin/inventory/new`, `/admin/inventory/:id/edit`, `/admin/purchase-orders`, `/admin/purchase-orders/new`, `/admin/purchase-orders/:id`, `/admin/suppliers`, `/admin/suppliers/new`, `/admin/suppliers/:id/edit`, `/admin/sales`, `/admin/messages`). Admin routes are lazy-loaded and protected by auth guard (F-005). Includes 404/wildcard route handling. No new entities, attributes, relationships, or enumerations added. Routes reference existing entities from F-002: Phone, Supplier, PurchaseOrder, Sale, ContactMessage. |
| 2026-01-28 | F-007    | Processed feature. No new entities derived — F-007 is a UI/layout feature (responsive public layout shell). Creates header component with shop logo/name and horizontal navigation links (Catalog, About, Contact), footer component with business info and copyright, and responsive hamburger/sidebar menu for mobile viewports (< 768px). Uses PrimeFlex utility classes for responsive grid behavior. Implements semantic HTML (nav, header, footer elements) with proper ARIA labels for screen reader accessibility. No new entities, attributes, relationships, or enumerations added. Navigation links reference routes already defined in F-006; underlying domain entities already exist from F-002. |
| 2026-01-28 | F-008    | Processed feature. No new entities derived — F-008 is a UI/layout feature (admin layout shell with collapsible sidebar navigation). Sidebar contains navigation links to: Dashboard, Inventory, Purchase Orders, Suppliers, Sales, Messages. Displays unread message count badge on Messages link — leverages existing `ContactMessage.is_read` boolean attribute (F-002). Top bar shows logged-in admin user email and logout button — uses auth session state from F-004 and UserRole enumeration (F-003). Mobile viewport sidebar collapses to overlay/drawer triggered by menu button. Active route is visually highlighted. No new entities, attributes, relationships, or enumerations added. References existing entities from F-002 (Phone, PurchaseOrder, Supplier, Sale, ContactMessage), routes from F-006, and auth state from F-004. |
| 2026-01-28 | F-009    | Processed feature. No new entities derived — F-009 is an admin UI/CRUD feature (Phone Inventory list view with PrimeNG Table). **Attribute refinement on Phone entity:** replaced single `price` (DECIMAL) attribute with two distinct attributes: `cost_price` (DECIMAL, NOT NULL) and `selling_price` (DECIMAL, NOT NULL) to support the inventory list's separate cost price and selling price columns. Updated featureRefs on Phone entity and attributes (brand_id, model, cost_price, selling_price, condition, status, storage) to include [F-009]. Updated featureRefs on Brand entity (referenced as table column). Updated featureRefs on PhoneImage entity `is_primary` attribute (used for image thumbnail column). Updated featureRefs on PhoneCondition and PhoneStatus enumerations (displayed as table columns with color-coded tags). No new entities, relationships, or enumerations added. Feature implements server-side lazy loading, sorting, global search (brand/model), bulk "Mark as Sold" (updates Phone.status), and bulk/single delete with confirmation dialogs. |
| 2026-01-28 | F-010    | Processed feature. No new entities derived — F-010 is an admin UI/CRUD feature (Phone Inventory add/edit reactive form). **Attribute refinement on Phone entity:** renamed `storage` (VARCHAR) to `storage_gb` (INTEGER) to align with form field naming and numeric validation; added 5 new attributes: `ram_gb` (INTEGER, NULLABLE), `battery_health` (INTEGER, NULLABLE, CHECK 0–100, conditionally visible for used/refurbished conditions), `imei` (VARCHAR, NULLABLE, UNIQUE), `purchase_date` (DATE, NULLABLE), `supplier_id` (UUID, FK → Supplier, NULLABLE), `notes` (TEXT, NULLABLE). **New relationship:** Phone → Supplier (Many-to-One via supplier_id, NULLABLE) — supplier dropdown populates from Supplier entity. Updated featureRefs on: Phone entity and attributes (brand_id, model, storage_gb, color, condition, cost_price, selling_price, status); Brand entity (autocomplete source); Supplier entity (dropdown source); Brand → Phone relationship; PhoneCondition enumeration (condition dropdown + battery_health conditional logic); PhoneStatus enumeration (status dropdown). Form validates required fields (model, cost_price, selling_price) and numeric constraints. |
| 2026-01-28 | F-011    | Processed feature. No new entities derived — F-011 is an image upload/management feature (multi-file image upload for phone records using Supabase Storage). **Attribute refinements on PhoneImage entity:** renamed `url` (TEXT) to `image_url` (TEXT, NOT NULL) to align with acceptance criteria naming and clarify as the publicly accessible URL; added `storage_path` (TEXT, NOT NULL) for internal Supabase Storage bucket path required for file deletion; added `display_order` (INTEGER, NOT NULL, DEFAULT 0) for drag-to-reorder position. Updated `is_primary` featureRefs to include [F-011] (set-as-primary functionality). Feature implements drag-and-drop upload, concurrent upload with individual progress indicators, preview thumbnails, drag-to-reorder, set primary image, and delete (removes from both Storage bucket and phone_images table). Client-side validation: file type (JPEG, PNG, WebP) and max file size (5MB). Images stored in Supabase Storage bucket with public access policies for catalog display. Updated featureRefs on: PhoneImage entity and attributes; Phone → PhoneImage relationship; phone_images RLS policies (anon, authenticated). |
| 2026-01-28 | F-012    | Processed feature. No new entities derived — F-012 is an admin CRUD/directory management feature (Brand Management with inline creation and dedicated management interface). **Attribute addition on Brand entity:** added `logo_url` (TEXT, NULLABLE) for optional brand logo upload, displayed alongside brand name in catalog filter dropdowns. Updated `name` attribute featureRefs to include [F-012] — database-level UNIQUE constraint enforces brand name uniqueness (acceptance criteria). Feature supports inline brand creation from phone form autocomplete (when typed brand doesn't exist), dedicated brand management interface, and optional logo upload. Editing a brand name propagates to all UI references via existing FK relationship (Brand → Phone). No new entities, relationships, or enumerations added. Updated featureRefs on: Brand entity (added F-012); Brand.name attribute (added F-012); Brand.logo_url attribute (new, F-012). |
| 2026-01-28 | F-013    | Processed feature. No new entities derived — F-013 is a public-facing UI/display feature (Public Phone Catalog with grid/list view toggle). Displays only phones with `status='available'` using PrimeNG DataView or custom PrimeFlex grid. Responsive layout: 1 column (mobile < 576px), 2 columns (tablet 576-991px), 3-4 columns (desktop >= 992px). Phone cards display: primary image (PhoneImage.is_primary=true with placeholder fallback), brand name (via Brand → Phone FK), model, selling_price, condition tag (colored badge from PhoneCondition enum), and storage_gb. No new entities, attributes, relationships, or enumerations added. Updated featureRefs on: Phone entity and attributes (brand_id, model, storage_gb, condition, selling_price, status — added F-013); Brand entity (added F-013); PhoneImage entity and attributes (image_url, is_primary — added F-013); PhoneCondition enumeration (all values — added F-013); PhoneStatus enumeration (entity-level and `available` value — added F-013); Brand → Phone relationship (added F-013); Phone → PhoneImage relationship (added F-013). |
| 2026-01-28 | F-014    | Processed feature. No new entities derived — F-014 is a public-facing UI/search feature (debounced catalog search by brand or model name). Implements a search bar on the public catalog page that filters phones by `Brand.name` or `Phone.model` with 300ms debounce, case-insensitive matching, dynamic result updates, "No phones found" empty-state message, and full catalog restore on input clear. Operates entirely on existing entities and attributes — no new entities, attributes, relationships, or enumerations added. Uses Brand → Phone FK relationship to resolve brand name for search matching. Updated featureRefs on: Brand entity (added F-014); Brand.name attribute (added F-014); Phone entity (added F-014); Phone.brand_id attribute (added F-014); Phone.model attribute (added F-014); Brand → Phone relationship (added F-014). |
| 2026-01-28 | F-015    | Processed feature. No new entities derived — F-015 is a public-facing UI/filter feature (catalog filter controls: brand dropdown, condition multi-select, storage checkboxes, price range slider). Filters combine with AND logic and work alongside search (F-014). Active filters shown as visual tags/chips with "Clear All Filters" button. URL query parameters update for shareable/bookmarkable filtered views. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Brand entity (added F-015); Brand.name attribute (added F-015); Phone entity (added F-015); Phone.brand_id attribute (added F-015); Phone.storage_gb attribute (added F-015); Phone.condition attribute (added F-015); Phone.selling_price attribute (added F-015); PhoneCondition enumeration and all values (added F-015); Brand → Phone relationship (added F-015). |
| 2026-01-28 | F-016    | Processed feature. No new entities derived — F-016 is a public-facing UI/sorting feature (catalog sorting controls: Newest First, Price Low to High, Price High to Low). Default sort is "Newest First" by `Phone.created_at` DESC. Price sorting uses `Phone.selling_price` ASC/DESC. Sorting applies within filtered results (integrates with F-014 search and F-015 filters). Active sort option is visually indicated in the UI. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Phone entity (added F-016); Phone.created_at attribute (added F-016); Phone.selling_price attribute (added F-016). |
| 2026-01-28 | F-017    | Processed feature. No new entities derived — F-017 is a public-facing UI/pagination feature (server-side catalog pagination using PrimeNG Paginator and Supabase `.range()` queries). Configurable page size (12, 24), page navigation controls, total record count display, and current page indicator. Paginator resets to page 1 on filter/search changes (integrates with F-014 search and F-015 filters). No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Phone entity (added F-017). |
| 2026-01-28 | F-018    | Processed feature. No new entities derived — F-018 is a public-facing UI/display feature (Phone Detail Page with full specifications and image gallery). Displays PrimeNG Galleria with thumbnail navigation using PhoneImage entity (image_url, is_primary, display_order). Shows all phone specs: brand name (via Brand → Phone FK), model, storage_gb, ram_gb (if not null), color (if not null), condition (PhoneCondition enum). Battery health displayed as visual progress bar (0-100%) for used/refurbished phones. Selling price prominently displayed. Availability status badge from PhoneStatus enum (e.g., green "Available"). WhatsApp inquiry button opens wa.me with pre-filled message containing brand, model, and storage_gb. Back-to-catalog link preserves previous filter/search state. "Phone not found" displayed for non-existent or unavailable phone_id. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Phone entity and attributes (brand_id, model, storage_gb, ram_gb, color, condition, battery_health, selling_price, status — added F-018); Brand entity (added F-018); PhoneImage entity and attributes (image_url, is_primary, display_order — added F-018); PhoneCondition enumeration and all values (added F-018); PhoneStatus enumeration and `available` value (added F-018); Brand → Phone relationship (added F-018); Phone → PhoneImage relationship (added F-018). |
| 2026-01-28 | F-019    | Processed feature. No new entities derived — F-019 is an admin CRUD feature (Supplier Management with PrimeNG Table list view and reactive add/edit form). **Attribute additions on Supplier entity:** added `contact_person` (VARCHAR, NULLABLE) for supplier contact person name displayed in list and form; added `notes` (TEXT, NULLABLE) for free-text supplier notes in the form. Updated featureRefs on existing Supplier attributes: `name` (required field with validation — added F-019), `contact_email` (list column and form field — added F-019), `contact_phone` (list column and form field — added F-019), `address` (form field — added F-019). Feature includes purchase order history view per supplier using existing Supplier → PurchaseOrder relationship. Delete prevention enforced by ON DELETE RESTRICT FK constraint — when supplier has existing purchase orders, delete is blocked with informative error message. No new entities, relationships, or enumerations added. Updated featureRefs on: Supplier entity (added F-019); Supplier → PurchaseOrder relationship (added F-019). |
| 2026-01-28 | F-020    | Processed feature. No new entities derived — F-020 is an admin UI/list feature (Purchase Order List and Filtering with PrimeNG Table). **Attribute addition on PurchaseOrder entity:** added `po_number` (VARCHAR, NOT NULL, UNIQUE) — human-readable purchase order number (e.g., PO-0001) displayed as the first column in the PO list view. Updated featureRefs on existing PurchaseOrder attributes: `supplier_id` (supplier name column and supplier filter — added F-020), `order_date` (list column, default sort descending — added F-020), `total_amount` (list column — added F-020), `status` (color-coded list column: pending=orange, received=green, cancelled=red — added F-020). Updated Supplier entity featureRefs (added F-020 — supplier name displayed in PO list and used as filter source). Updated PurchaseOrderStatus enumeration and all values (added F-020 — status filter and color-coded display). Updated Supplier → PurchaseOrder relationship featureRefs (added F-020 — supplier filter leverages FK). Summary statistics at top are computed aggregates with no data model impact. No new entities or relationships added. |
| 2026-01-28 | F-021    | Processed feature. No new entities derived — F-021 is an admin UI/form feature (Purchase Order Creation form with dynamic line items). **Attribute refinements on PurchaseOrderItem entity:** replaced `phone_id` (UUID, FK → Phone) with `brand` (VARCHAR, NOT NULL) and `model` (VARCHAR, NOT NULL) text fields — PO line items capture brand/model as free-text rather than referencing existing Phone records; renamed `unit_price` to `unit_cost` (DECIMAL, NOT NULL) to align with feature specification naming; updated `quantity` constraint from CHECK > 0 to CHECK >= 1 per validation acceptance criteria. **Removed relationship:** Phone → PurchaseOrderItem (One-to-Many via phone_id) — no longer applicable since line items use text-based brand/model instead of Phone FK. Updated PurchaseOrder `total_amount` constraint description to clarify auto-calculation as sum of (quantity × unit_cost) for all line items. Updated PurchaseOrder `status` description to note 'pending' as default on creation. Updated PurchaseOrder `notes` featureRefs (form text field — added F-021). Validation requires at least one line item per PO and quantity >= 1. Updated featureRefs on: PurchaseOrder entity (added F-021) and attributes (supplier_id, order_date, total_amount, status, notes); PurchaseOrderItem entity (added F-021) and attributes (purchase_order_id, brand new, model new, quantity, unit_cost renamed); Supplier entity (added F-021 — supplier dropdown source); PurchaseOrderStatus enumeration `pending` value (added F-021 — default on creation); Supplier → PurchaseOrder relationship (added F-021); PurchaseOrder → PurchaseOrderItem relationship (added F-021, at least one line item required). |
| 2026-01-28 | F-022    | Processed feature. No new entities derived — F-022 is an admin UI/detail view feature (read-only Purchase Order Detail page with status change actions). Displays full PO header information: supplier details (via Supplier → PurchaseOrder FK), order_date, status (from PurchaseOrderStatus enum), total_amount, and notes. Displays line items table showing each PurchaseOrderItem: brand, model, quantity, unit_cost, and calculated line total (quantity × unit_cost). Shows overall PO total. Status-dependent action buttons: 'Mark as Received' and 'Cancel' available when status='pending'; buttons disabled/hidden when status='received' or 'cancelled'. Includes navigation link back to PO list. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: PurchaseOrder entity (added F-022) and attributes (supplier_id, order_date, total_amount, status, notes); PurchaseOrderItem entity (added F-022) and attributes (purchase_order_id, brand, model, quantity, unit_cost); Supplier entity (added F-022 — supplier details displayed in PO header); PurchaseOrderStatus enumeration and all values (added F-022 — status display and conditional action buttons: pending enables 'Mark as Received'/'Cancel', received/cancelled disables buttons); Supplier → PurchaseOrder relationship (added F-022); PurchaseOrder → PurchaseOrderItem relationship (added F-022 — line items table). |
| 2026-01-28 | F-023    | Processed feature. No new entities derived — F-023 is an admin workflow feature (Purchase Order Receiving Workflow: Mark as Received). Implements the workflow that transitions a PO from 'pending' to 'received' and creates individual Phone inventory records from PurchaseOrderItem line items. For each line item with quantity=N, generates N phone record forms pre-filled with brand and model from the PO item. Admin enters per-unit details: color, IMEI, condition, battery_health, selling_price, storage_gb, ram_gb. On confirmation: PO status transitions to 'received', Phone records created with status='available', supplier_id auto-set from PO's supplier, cost_price auto-set from PO item's unit_cost. No partial receiving in MVP — all items received at once. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Phone entity and 12 attributes (brand_id, model, storage_gb, ram_gb, color, condition, battery_health, imei, cost_price, selling_price, status, supplier_id — added F-023); Supplier entity (added F-023); PurchaseOrder entity and status attribute (added F-023 — pending→received transition); PurchaseOrderItem entity and 4 attributes (brand, model, quantity, unit_cost — added F-023 — drive phone record generation); PhoneCondition enumeration and all values (added F-023); PhoneStatus enumeration and `available` value (added F-023); PurchaseOrderStatus enumeration and `pending`/`received` values (added F-023); Brand → Phone relationship (added F-023); Phone → Supplier relationship (added F-023); Supplier → PurchaseOrder relationship (added F-023); PurchaseOrder → PurchaseOrderItem relationship (added F-023). |
| 2026-01-28 | F-024    | Processed feature. No new entities derived — F-024 is an admin UI/list feature (Sales Tracking List with PrimeNG Table, date range filtering, and summary row). **Attribute changes on Sale entity:** added `cost_price` (DECIMAL, NOT NULL) to record cost price at time of sale for profit calculation (sale_price - cost_price); avoids dependency on mutable Phone.cost_price for historical accuracy. Renamed `customer_name` to `buyer_name` (VARCHAR, NULLABLE) to align with F-024 acceptance criteria naming ("buyer_name" column). Updated `sale_date` constraint description to note default descending sort and date range filtering support. Updated `sale_price` constraint description to note display in sales list and total revenue computation. Profit column is computed (sale_price - cost_price), color-coded green (positive) / red (negative) — no data model impact. Summary row aggregates (total revenue, total cost, total profit, average margin %) are computed at query time — no data model impact. Clicking phone name navigates to phone edit page — references Phone entity and its Brand relationship for display. Updated featureRefs on: Sale entity (added F-024) and attributes (phone_id, sale_date, sale_price, cost_price new, buyer_name renamed — added F-024); Phone entity (added F-024) and attributes (brand_id, model, cost_price — added F-024, phone info displayed in sales list); Brand entity (added F-024) and attribute name (added F-024, brand name displayed in sales list via Phone → Brand FK); Phone → Sale relationship (added F-024); Brand → Phone relationship (added F-024); sales RLS policy authenticated role (added F-024). |
| 2026-01-28 | F-025    | Processed feature. No new entities derived — F-025 is an admin UI/workflow feature (Mark as Sold Dialog triggered from inventory list). **Attribute additions on Sale entity:** added `buyer_phone` (VARCHAR, NULLABLE) for buyer's phone number collected in the Mark as Sold dialog; added `buyer_email` (VARCHAR, NULLABLE) for buyer's email address collected in the Mark as Sold dialog. Updated existing Sale attribute constraint descriptions: `sale_price` pre-filled with `Phone.selling_price`; `sale_date` defaults to today; `notes` collected as optional field. Updated featureRefs on: Phone entity (added F-025) and attributes (selling_price — pre-fills sale_price in dialog, status — updated to 'sold' on confirmation); Sale entity (added F-025) and attributes (phone_id, sale_date, sale_price, buyer_name, buyer_phone new, buyer_email new, notes — added F-025); PhoneStatus enumeration (added F-025) and values (available — phone must be available to trigger dialog, sold — status set on confirmation); Phone → Sale relationship (added F-025 — dialog creates sale record and updates phone status). |
| 2026-01-28 | F-026    | Processed feature. No new entities derived — F-026 is an admin dashboard/analytics feature (Admin Dashboard with KPI Cards). Implements 4 read-only KPI cards computed as aggregates from existing entities: Total Stock (count of `Phone` where `status='available'`), Stock Value (sum of `Phone.cost_price` for available phones), Potential Profit (sum of `Phone.selling_price - Phone.cost_price` for available phones), Total Sales (count of `Sale` records). All KPIs are computed at query time with no data model impact. KPIs refresh on data changes to reflect current state. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Phone entity (added F-026) and attributes (cost_price — stock value calculation, selling_price — potential profit calculation, status — filters available phones for 3 stock KPIs); Sale entity (added F-026 — total sales count KPI); PhoneStatus enumeration (added F-026) and `available` value (added F-026 — filters phones for stock count, stock value, and potential profit KPIs). |
| 2026-01-28 | F-027    | Processed feature. No new entities derived — F-027 is an admin dashboard/analytics visualization feature (Dashboard Charts using PrimeNG Chart / Chart.js). Implements two responsive charts: (1) Sales bar chart — aggregates `Sale.sale_price` by month from `Sale.sale_date` for the current year, with empty state message when no sales data exists; (2) Stock-by-brand doughnut chart — counts `Phone` records where `status='available'` grouped by `Brand.name` via `Phone.brand_id` FK, with each segment labeled by brand name and count. Both charts use the application's color theme. All chart data is computed as aggregates at query time — no new entities, attributes, relationships, or enumerations added. Updated featureRefs on: Brand entity (added F-027) and `name` attribute (added F-027 — doughnut chart segment labels); Phone entity (added F-027) and attributes (`brand_id` — groups phones by brand for doughnut chart, `status` — filters available phones); Sale entity (added F-027) and attributes (`sale_price` — bar chart revenue values, `sale_date` — monthly grouping axis); PhoneStatus enumeration and `available` value (added F-027 — filters phones for stock-by-brand doughnut chart); Brand → Phone relationship (added F-027 — resolves brand name for doughnut chart segments); Phone → Sale relationship (added F-027 — sale records provide revenue data for bar chart). |
| 2026-01-28 | F-028    | Processed feature. No new entities derived — F-028 is an admin dashboard/display feature (Dashboard Recently Added Phones Table). Displays a small table on the admin dashboard showing the 5 most recently added phones ordered by `Phone.created_at` DESC with columns: brand name (via Brand → Phone FK), model, condition (PhoneCondition enum), selling_price, and created_at (date added). Each row links to `/admin/inventory/:id/edit` for quick editing. Gracefully handles fewer than 5 phones without error. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Brand entity (added F-028) and `name` attribute (added F-028 — brand column in recently added table); Phone entity (added F-028) and attributes (`brand_id` — resolves brand name for display, `model` — table column, `condition` — table column with PhoneCondition enum values, `selling_price` — table column, `created_at` — ordering DESC and date added column); PhoneCondition enumeration and all values: new, used, refurbished (added F-028 — condition column display); Brand → Phone relationship (added F-028 — resolves brand name for each table row). |
| 2026-01-28 | F-029    | Processed feature. No new entities derived — F-029 is a public-facing UI/form feature (Contact Page with Business Info and Contact Form). Implements a two-column layout: business information on the left (address, phone as clickable tel: link, email as clickable mailto: link, WhatsApp button opening wa.me with shop phone number) and a contact form on the right. **Attribute addition on ContactMessage entity:** added `phone` (VARCHAR, NULLABLE) for optional phone number field on the public contact form — F-029 acceptance criteria specifies "phone (optional)" as a form field not previously modeled. Updated existing ContactMessage attributes featureRefs: `name` (required form field — added F-029), `email` (required form field with email format validation — added F-029), `message` (required form field — added F-029), `is_read` (defaults to false on form submission — added F-029). Updated ContactMessage entity-level featureRefs to include [F-029]. Updated contact_messages RLS policy for `anon` role featureRefs to include [F-029] — anonymous users can INSERT contact form submissions without authentication. Form displays validation error for invalid email format, shows success message on successful submission, and clears all fields after success. Responsive layout stacks columns on mobile. No new entities, relationships, or enumerations added. |
| 2026-01-28 | F-030    | Processed feature. No new entities derived — F-030 is a spam prevention/security feature (Contact Form Spam Prevention with multi-layered defenses). Implements three complementary spam prevention mechanisms for the public contact form: (1) honeypot hidden field — a CSS-hidden form field that bots fill but humans cannot see; submissions with honeypot filled are silently rejected without error message; (2) client-side rate limiting — maximum 3 submissions per 5 minutes tracked via client-side storage; 4th attempt within window displays rate limit message; (3) optional reCAPTCHA v3 integration — invisible bot detection where form submissions include a reCAPTCHA token validated server-side; configured via environment variable. All mechanisms operate at the form/validation layer before database insert — no new persistent storage required. The honeypot field is a transient form control never persisted to the database. Rate limiting state is stored client-side (e.g., localStorage/sessionStorage). reCAPTCHA tokens are validated in-flight and not stored. Legitimate users experience no friction or visible CAPTCHAs (reCAPTCHA v3 is invisible). No new entities, attributes, relationships, or enumerations added — operates entirely on the existing ContactMessage entity insert pathway. Updated featureRefs on: ContactMessage entity (added F-030 — spam prevention guards the contact form submission pathway); contact_messages RLS policy for `anon` role (added F-030 — spam prevention applies to the same anonymous INSERT access governed by this policy). |
| 2026-01-28 | F-031    | Processed feature. No new entities derived — F-031 is an admin UI/CRUD feature (Admin Messages Management page with PrimeNG Table). Displays all contact_messages in a PrimeNG Table with expandable rows, sorted by `created_at` descending. Table columns: name, email, phone, message preview (first 50 characters truncated), created_at date, and is_read status badge (read/unread). Expandable rows reveal full message text. Supports toggling `is_read` per message (read↔unread) and deleting messages with confirmation dialog. Sidebar navigation Messages link shows an unread count badge (count of ContactMessage where `is_read=false`) that updates in real-time as messages are toggled. No new entities, attributes, relationships, or enumerations added — operates entirely on existing ContactMessage entity and its attributes. Updated featureRefs on: ContactMessage entity (added F-031) and attributes (`id` — row-level toggle and delete operations, `name` — table column, `email` — table column, `phone` — table column, `message` — truncated preview column and expandable full text, `is_read` — read/unread toggle and sidebar badge count, `created_at` — default sort descending and date column); contact_messages RLS policy for `authenticated` role (added F-031 — admin SELECT for listing, UPDATE for is_read toggle, DELETE for message removal). |
| 2026-01-28 | F-032    | Processed feature. No new entities derived — F-032 is a public-facing UI/static content feature (About Us Page with business description and opening hours). Content is hardcoded or configurable — not stored in any database entity. Uses the public layout shell (header + footer) from F-007 and the `/about` route defined in F-006. Responsive layout consistent with the rest of the public site. Supports headings, paragraphs, and optionally a business image. No new entities, attributes, relationships, or enumerations added. No existing entity featureRefs updated — feature has no database interaction. |
| 2026-01-28 | F-033    | Processed feature. No new entities derived — F-033 is a frontend UI/service infrastructure feature (Global Toast Notification Service using PrimeNG Toast). Implements an injectable Angular service providing success, error, warning, and info toast notifications used across the application for CRUD operation feedback, form submission results, validation errors, and system messages. Toasts are transient UI elements that auto-dismiss after a configurable duration (3-5 seconds) and stack vertically when multiple are active. The service is purely client-side — toast messages are not persisted to any database entity. No new entities, attributes, relationships, or enumerations added. No existing entity featureRefs updated — feature has no database interaction or data model impact. |
| 2026-01-28 | F-034    | Processed feature. No new entities derived — F-034 is a frontend UI/UX feature (Reusable Confirmation Dialogs for Destructive Actions using PrimeNG ConfirmDialog). Implements confirmation dialogs for all destructive actions: deleting phones (single and bulk), deleting suppliers, deleting messages, cancelling POs, and bulk operations. Each dialog displays an "Are you sure?" message with item details, "Confirm" and "Cancel" buttons. Bulk delete dialogs state the count of items to be deleted. Confirmation dialogs are transient UI components — no new data is persisted to any database entity. The feature guards existing destructive operations already defined in previous features (F-009 phone delete, F-019 supplier delete, F-031 message delete, F-022 PO cancel). No new entities, attributes, relationships, or enumerations added. Updated entity-level featureRefs on: Phone entity (added F-034 — single and bulk delete confirmation); Supplier entity (added F-034 — delete confirmation); ContactMessage entity (added F-034 — delete confirmation); PurchaseOrder entity (added F-034 — cancel PO confirmation); PurchaseOrderStatus enumeration (added F-034) and `cancelled` value (added F-034 — cancel PO action guarded by confirmation dialog). |
| 2026-01-28 | F-035    | Processed feature. No new entities derived — F-035 is a frontend UI/UX feature (Loading States and Skeleton Screens). Implements loading indicators and skeleton screen placeholders across the application: PrimeNG Table loading spinner overlays during data fetches, skeleton card placeholders on the catalog page, loading spinners on form submit buttons (disabled to prevent double-submission), skeleton placeholders for dashboard KPI cards, and loading state clearance with error message display on API failures. All loading states are transient UI states managed in Angular component properties (e.g., `isLoading: boolean`) — not persisted to any database. No new entities, attributes, relationships, or enumerations added. No existing entity featureRefs updated — feature has no database interaction or data model impact. |
| 2026-01-28 | F-036    | Processed feature. No new entities derived — F-036 is a frontend UI/CSS/layout feature (Responsive Design - Mobile First). Ensures all pages and components follow a mobile-first responsive design approach using PrimeFlex breakpoints and SCSS media queries. Implements catalog 1/2/3-4 column grid progression across viewports, horizontal scrolling admin tables on mobile with frozen action columns, vertical stacking for forms on small screens, hamburger/drawer navigation for mobile, 44x44px minimum touch targets (WCAG 2.5.5), and content reflow without horizontal scrolling at 320px (WCAG 1.4.10). All requirements are purely presentational CSS/layout concerns describing how existing UI components render responsively — no new data is stored, queried, or modeled. No new entities, attributes, relationships, or enumerations added. No existing entity featureRefs updated — feature has no database interaction or data model impact. |
| 2026-01-28 | F-037    | Processed feature. No new entities derived — F-037 is a frontend SEO/meta tags feature (Dynamic SEO Meta Tags for Public Pages using Angular Title and Meta services). Implements dynamic meta tags (title, description, Open Graph: og:title, og:description, og:image, og:url, and Twitter Card) for all public pages. Phone detail pages construct unique meta tags from existing entity attributes: brand name (`Brand.name` via Brand → Phone FK), model (`Phone.model`), selling price (`Phone.selling_price`), condition (`Phone.condition`), and primary image (`PhoneImage.image_url` where `PhoneImage.is_primary=true`) for og:image. Catalog and static pages (About, Contact) use appropriate hardcoded default meta tags. Canonical URL meta tags are set per page, derived from the route URL. All meta tag values are computed at runtime and injected into the browser DOM `<head>` element — no new data is persisted to any database entity. No new entities, attributes, relationships, or enumerations added. Updated featureRefs on: Brand entity (added F-037) and `name` attribute (added F-037); Phone entity (added F-037) and attributes (`model`, `selling_price`, `condition` — added F-037); PhoneImage entity (added F-037) and attributes (`image_url`, `is_primary` — added F-037); Brand → Phone relationship (added F-037); Phone → PhoneImage relationship (added F-037). |
| 2026-01-28 | F-038    | Processed feature. No new entities derived — F-038 is a frontend infrastructure/error handling feature (Global Error Handling Strategy with Angular ErrorHandler and HTTP Interceptor). Implements: (1) Angular ErrorHandler override for uncaught JavaScript exceptions — catches all unhandled errors and logs them to the console (or future monitoring service); (2) HTTP interceptor for Supabase API error responses — 401 redirects to login page (leverages auth state from F-004), 403 shows 'Permission denied' toast, 500 shows generic 'Something went wrong' toast, network failures show 'Network error - please check your connection' toast; (3) fallback error page for critical failures. All error handling operates at the Angular application layer — errors are intercepted in-flight and surfaced via transient toast notifications (leverages toast service from F-033) or page redirects. Stack traces and technical error details are logged to the browser console only, never exposed to end users. No error data is persisted to any database entity. No new entities, attributes, relationships, or enumerations added. No existing entity featureRefs updated — feature has no database interaction or data model impact. |
| 2026-01-28 | F-039    | Processed feature. No new entities derived — F-039 is a public-facing UI/presentational feature (Google Maps Embed on Contact Page). Embeds a lazy-loaded (`loading="lazy"`) Google Maps iframe on the contact page (F-029) showing the shop's physical location. The map is responsive and fits within its container on all screen sizes. A fallback text address is displayed when the map cannot load (e.g., browser extension blocks iframes, network issues). The map embed URL/coordinates and the fallback address text are static configuration values — either hardcoded in the component template or read from an environment variable — and are not stored in any database entity. No database queries are made. No new entities, attributes, relationships, or enumerations added. No existing entity featureRefs updated — feature has no database interaction or data model impact. |
| 2026-01-28 | F-040    | Processed feature. No new entities derived — F-040 is a storage infrastructure/configuration feature (Supabase Storage Bucket Configuration for phone images). Configures a `phone-images` Supabase Storage bucket with: public read access (images accessible via URL without authentication), authenticated-only upload/update/delete via Storage RLS policies, 5MB maximum file size limit, and allowed MIME types restricted to image/jpeg, image/png, and image/webp. **New section added:** Storage Bucket Configuration (Section 5) documenting bucket properties, access policies, file constraints, MIME type restrictions, and relationship to PhoneImage entity. Updated PhoneImage entity featureRefs to include [F-040] — the bucket is the storage backend for phone images whose public URLs are stored in `PhoneImage.image_url` and internal paths in `PhoneImage.storage_path`. Updated `image_url` attribute constraint description to reference phone-images bucket. Updated `storage_path` attribute constraint description to reference phone-images bucket and added F-040 to its featureRefs. No new entities, relationships, or enumerations added. |
| 2026-01-28 | F-041    | Processed feature. No new entities derived — F-041 is an admin UI/workflow feature (Inventory Status Quick Actions: Mark as Available, Mark as Reserved, Mark as Sold). Implements quick status change actions in the inventory list allowing rapid `Phone.status` changes without navigating to the edit form. 'Mark as Available' and 'Mark as Reserved' update status immediately with a confirmation toast. 'Mark as Sold' opens the full Mark as Sold dialog (F-025) to create a Sale record. Table row status tags update in real-time without full page reload. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Phone entity (added F-041) and `status` attribute (added F-041 — quick actions change phone status directly); PhoneStatus enumeration (added F-041) and all three values: `available` (added F-041 — set via quick action), `sold` (added F-041 — triggers F-025 sale dialog via quick action), `reserved` (added F-041 — set via quick action). |
| 2026-01-28 | F-042    | Processed feature. No new entities derived — F-042 is a frontend accessibility/UX feature (Keyboard Accessibility and Focus Management meeting WCAG 2.1 AA). Ensures all interactive elements (buttons, links, inputs) are reachable via Tab key with visible focus indicators (outline/ring per WCAG 2.4.7). Dialogs trap focus within their boundaries (Tab cycles through dialog elements only) and return focus to the triggering element on close. Forms support full tab navigation order. PrimeNG components are augmented with proper ARIA attributes (role, aria-label, aria-expanded) where PrimeNG defaults are insufficient. Catalog phone cards are keyboard-navigable and activatable via Enter/Space keys. All requirements are purely frontend HTML/CSS/Angular accessibility concerns — focus ring CSS styles, tabindex attributes, ARIA attribute directives, keyboard event handlers (keydown.enter, keydown.space), and CDK focus trap logic for dialogs. No data is stored, queried, or modeled. No new entities, attributes, relationships, or enumerations added. No existing entity featureRefs updated — feature has no database interaction or data model impact. |
| 2026-01-28 | F-043    | Processed feature. No new entities derived — F-043 is a frontend image optimization/performance feature (Image Optimization and Lazy Loading for catalog and phone detail pages). Implements: (1) native `loading='lazy'` attribute on off-screen images for deferred loading; (2) responsive image sizes via `srcset` using Supabase Storage image transformations (e.g., 300px thumbnails for catalog cards, full size for detail gallery); (3) WebP format preference when supported by Supabase image transformations; (4) placeholder/blur-up effect during image load; (5) explicit width/height attributes to prevent Cumulative Layout Shift (CLS); (6) styled placeholder image for phones with no images; (7) primary full-size image loads first in phone detail gallery while thumbnails load lazily. All optimization behaviors are frontend rendering concerns operating on existing PhoneImage entity attributes — `image_url` is used with Supabase image transform URL parameters for responsive sizing and format conversion, `is_primary` determines load priority (primary loads eagerly, others lazily), `display_order` determines thumbnail lazy-load sequence. No new entities, attributes, relationships, or enumerations added. Updated featureRefs on: PhoneImage entity (added F-043) and attributes (`image_url` — Supabase image transforms for srcset/WebP, `is_primary` — primary image load priority, `display_order` — thumbnail lazy-load order); Phone → PhoneImage relationship (added F-043 — fetches images for catalog cards and detail gallery); phone-images Storage Bucket Configuration (added F-043 — image transformations for responsive sizing and WebP format preference). |
| 2026-01-28 | F-044    | Processed feature. No new entities derived — F-044 is an admin UI/export feature (Export Sales Data to CSV). Allows admin to export sales data to CSV format for external analysis or accounting. Export is generated client-side from the current dataset, respects active date range filters, and downloads a CSV file with a timestamped filename. CSV columns map to existing entity attributes: phone brand (`Brand.name` via Phone → Brand FK), model (`Phone.model`), sale_price (`Sale.sale_price`), cost_price (`Sale.cost_price`), profit (computed: sale_price - cost_price — no data model impact), buyer_name (`Sale.buyer_name`), buyer_email (`Sale.buyer_email`), sale_date (`Sale.sale_date`). No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Brand entity (added F-044) and `name` attribute (added F-044 — phone brand column in CSV export); Phone entity (added F-044) and `model` attribute (added F-044 — model column in CSV export); Sale entity (added F-044) and attributes (`sale_date`, `sale_price`, `cost_price`, `buyer_name`, `buyer_email` — all CSV export columns); Brand → Phone relationship (added F-044 — resolves brand name for CSV export); Phone → Sale relationship (added F-044 — resolves phone info for CSV export); sales RLS policy authenticated role (added F-044 — data access for export). |
| 2026-01-28 | F-045    | Processed feature. No new entities derived — F-045 is an admin UI/export feature (Export Inventory Data to CSV). Allows admin to export the full inventory list to CSV format, respecting active search/filter criteria. CSV includes all phone columns: brand (`Brand.name` via Brand → Phone FK), model, storage_gb, ram_gb, color, condition (PhoneCondition enum), battery_health, cost_price, selling_price, status (PhoneStatus enum), purchase_date. Sensitive data (IMEI and notes) included only for authenticated admin users. Export is generated client-side — no new persistent storage required. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Brand entity (added F-045) and `name` attribute (added F-045 — brand column in CSV export); Phone entity (added F-045) and 12 attributes (`model`, `storage_gb`, `ram_gb`, `color`, `condition`, `battery_health`, `imei`, `cost_price`, `selling_price`, `status`, `purchase_date`, `notes` — all CSV export columns); PhoneCondition enumeration and all values: new, used, refurbished (added F-045 — condition column in CSV); PhoneStatus enumeration and all values: available, sold, reserved (added F-045 — status column in CSV); Brand → Phone relationship (added F-045 — resolves brand name for CSV export); phones RLS policy authenticated role (added F-045 — data access for inventory export). |
| 2026-01-28 | F-046    | Processed feature. No new entities derived — F-046 is a public-facing UI/URL state management feature (Phone Catalog URL State Management). Persists catalog filter, search, sort, and pagination state in URL query parameters (`?brand=`, `?condition=`, `?storage=`, `?price_min=`, `?price_max=`, `?sort=`, `?page=`) enabling bookmarking, sharing, and browser back/forward navigation to restore exact catalog views. State is synchronized bidirectionally between URL and UI controls. All URL parameters map to existing entity attributes used by catalog features (F-014 search, F-015 filters, F-016 sorting, F-017 pagination). No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements and is purely client-side URL state management. Updated featureRefs on: Brand entity (added F-046) and `name` attribute (added F-046 — brand filter URL parameter); Phone entity (added F-046) and attributes (`brand_id` — resolves brand for URL filter, `storage_gb` — storage filter URL parameter, `condition` — condition filter URL parameter, `selling_price` — price sort and price range URL parameters, `created_at` — newest-first sort URL parameter); PhoneCondition enumeration and all values: new, used, refurbished (added F-046 — condition filter values in URL parameters); Brand → Phone relationship (added F-046 — resolves brand name for URL filter parameter). |
| 2026-01-28 | F-047    | Processed feature. No new entities derived — F-047 is an admin workflow feature (PO Cancellation Workflow). Implements the ability to cancel a pending purchase order by transitioning `PurchaseOrder.status` from 'pending' to 'cancelled' (PurchaseOrderStatus enum). Cancellation is irreversible — a cancelled PO cannot be received. Requires a confirmation dialog explaining the action is irreversible. Cancelled POs display a red status tag in the PO list view. For cancelled POs, 'Mark as Received' and 'Cancel' buttons are disabled. For received POs, the 'Cancel' button is not available. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: PurchaseOrder entity (added F-047) and `status` attribute (added F-047 — pending→cancelled transition with irreversible confirmation dialog); PurchaseOrderStatus enumeration (added F-047) and all three values: `pending` (added F-047 — source state for cancellation workflow, 'Cancel Order' button available), `received` (added F-047 — 'Cancel' button not available for received POs), `cancelled` (added F-047 — target state of cancellation, buttons disabled, red tag in list, irreversible action). |
| 2026-01-28 | F-048    | Processed feature. No new entities derived — F-048 is an admin dashboard/analytics filtering feature (Dashboard Date Range Selector). Adds a date range selector to the admin dashboard with preset options (This Month, Last 30 Days, This Quarter, This Year, All Time, Custom) that filters KPI cards (total sales count, revenue) and the sales chart by the selected time period. When 'Custom' is selected, a date range picker appears for manual start/end date selection. Default selection is 'This Month' or 'All Time'. All filtering operates on existing `Sale.sale_date` attribute at query time — date range selection is transient component state, not persisted to any database entity. **New enumeration added:** DashboardDateRange (Section 2.5) — a frontend-only enumeration with 6 values (this_month, last_30_days, this_quarter, this_year, all_time, custom) documenting the preset date range options in the UI selector. No new entities, attributes, or relationships added. Updated featureRefs on: Sale entity (added F-048) and attributes (`sale_date` — date range filter axis, `sale_price` — revenue KPI aggregation filtered by date range, `cost_price` — profit calculation filtered by date range); Phone → Sale relationship (added F-048 — sale data for date-filtered dashboard KPIs and charts). |
| 2026-01-28 | F-049    | Processed feature. No new entities derived — F-049 is a frontend infrastructure/PWA configuration feature (PWA Support - Offline Capable and Installable). Converts the Angular application into a Progressive Web App using `@angular/pwa` schematics. Implements: (1) Angular service worker (`ngsw-worker.js`) for caching static assets (JS bundles, CSS, images) enabling offline access to previously viewed public catalog pages; (2) web app manifest (`manifest.webmanifest`) containing app name, icons (multiple sizes for various devices), theme color, background color, display mode (standalone), and start_url — enables 'Add to Home Screen' install prompt on mobile Chrome and other supporting browsers; (3) offline fallback page displayed when the network is unavailable and the requested page has not been cached by the service worker. The service worker automatically caches static assets on install and serves cached responses when the network is unavailable. Previously viewed public catalog pages (phone listings, phone detail) remain accessible offline. All PWA artifacts (manifest, service worker config, offline fallback HTML) are static configuration/build files generated by the `@angular/pwa` schematic — no data is persisted to any database entity. Offline caching operates at the HTTP response layer on existing public entities (Phone, Brand, PhoneImage) without requiring any data model changes. No new entities, attributes, relationships, or enumerations added. No existing entity featureRefs updated — feature has no database interaction or data model impact. |
| 2026-01-28 | F-051    | Processed feature. No new entities derived — F-051 is an admin UI/print feature (Print Phone Label / Price Tag). Generates a printable price tag or label for a phone using CSS print media queries (`@media print`). The label displays existing phone data in a formatted layout: brand name (`Brand.name` via Brand → Phone FK), model (`Phone.model`), storage capacity (`Phone.storage_gb`), condition (`Phone.condition` from PhoneCondition enum), and selling price (`Phone.selling_price`). Optionally includes a QR code linking to the public phone detail page (`/phone/:id`). Label layout is designed to fit standard label paper sizes via CSS print styling. 'Print Label' button is accessible from the phone inventory interface. The QR code and print-friendly view are generated client-side — no new data is persisted. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Brand entity (added F-051) and `name` attribute (added F-051 — brand name displayed on printed label); Phone entity (added F-051) and attributes (`brand_id` — resolves brand name for label display, `model` — label field, `storage_gb` — label field, `condition` — label field showing PhoneCondition enum value, `selling_price` — prominently displayed price on label); PhoneCondition enumeration and all values: new, used, refurbished (added F-051 — condition displayed on printed label); Brand → Phone relationship (added F-051 — resolves brand name for label). |
| 2026-01-28 | F-050    | Processed feature. **New entity derived:** StockAlertConfig (Section 1.9) — a singleton configuration entity storing configurable stock alert thresholds for the admin dashboard. Attributes: `id` (UUID, PK), `low_stock_threshold` (INTEGER, NOT NULL, DEFAULT 5, CHECK >= 0 — total available stock count below which a low-stock warning alert is displayed), `enable_brand_zero_alert` (BOOLEAN, NOT NULL, DEFAULT true — enables per-brand zero-stock alerts), `created_at` (TIMESTAMPTZ), `updated_at` (TIMESTAMPTZ). Alerts are computed dynamically at query time by counting `Phone` records with `status='available'` (total stock) and grouping by `Brand` via `Phone.brand_id` FK (per-brand stock). Each alert includes a link to `/admin/purchase-orders/new` for proactive reordering. Alerts are displayed prominently above the dashboard KPI cards. **No new enumerations added** — alert types (total low stock, brand zero stock) are determined at runtime from config + inventory data. **No new relationships added** — StockAlertConfig is a standalone singleton; stock data is queried from existing Phone and Brand entities via existing Brand → Phone relationship. Updated featureRefs on: Brand entity (added F-050) and `name` attribute (added F-050 — per-brand alert labels); Phone entity (added F-050) and attributes (`brand_id` — groups phones by brand for per-brand alerts, `status` — filters available phones for stock counting); PhoneStatus enumeration (added F-050) and `available` value (added F-050 — stock alert computation filter); Brand → Phone relationship (added F-050 — resolves brand for per-brand stock grouping). Added RLS policies for `stock_alert_configs` table: anon (no access), authenticated (full CRUD). |
| 2026-01-28 | F-052    | Processed feature. No new entities derived — F-052 is a frontend real-time subscription feature (Supabase Realtime for Unread Message Count). Uses Supabase Realtime subscriptions to live-update the unread message count badge in the admin sidebar whenever a new contact message is submitted (INSERT on `contact_messages` table) or a message is marked as read/unread (UPDATE on `ContactMessage.is_read`). Subscription is established on admin login and cleaned up on logout. Automatic reconnection on network interruption eliminates polling or manual refresh. All real-time behavior operates at the Supabase client subscription layer — no new persistent storage, entities, attributes, relationships, or enumerations required. Updated featureRefs on: ContactMessage entity (added F-052 — Realtime subscription monitors this table for INSERT and UPDATE events); ContactMessage.is_read attribute (added F-052 — unread count badge computation driven by real-time changes to this boolean attribute). |
| 2026-01-28 | F-053    | Processed feature. No new entities derived — F-053 is a public-facing UI/comparison feature (Phone Comparison Feature allowing side-by-side comparison of up to 3 phones). Public visitors can select up to 3 phones via 'Compare' checkbox/button on catalog cards. A floating comparison bar appears at the bottom showing selected phones. Clicking 'Compare' opens a side-by-side comparison view with specs aligned in columns: brand name (via Brand → Phone FK), model, storage_gb, ram_gb, condition (PhoneCondition enum), battery_health, and selling_price (as price). Selection persists during the browsing session using client-side storage (e.g., sessionStorage) — not persisted to any database entity. Users are informed when the 3-phone maximum is reached. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Brand entity (added F-053) and `name` attribute (added F-053 — brand name in comparison column); Phone entity (added F-053) and attributes (`brand_id` — resolves brand for comparison, `model` — comparison column, `storage_gb` — comparison column, `ram_gb` — comparison column, `condition` — comparison column, `battery_health` — comparison column, `selling_price` — price comparison column); PhoneCondition enumeration and all values: new, used, refurbished (added F-053 — condition displayed in comparison view); Brand → Phone relationship (added F-053 — resolves brand name for comparison display). |
| 2026-01-28 | F-054    | Processed feature. No new entities derived — F-054 is an admin UI/display feature (Inventory Profit Margin Indicators). Displays a computed profit margin percentage for each phone in the inventory list, calculated as `((selling_price - cost_price) / selling_price * 100)`. Margin values are color-coded: red (below 10% — low margin alert), yellow/orange (10%–25% — medium margin), green (above 25% — good margin). The margin column is sortable to quickly find lowest/highest margin items, helping admin identify pricing issues. Margin is computed at display time from existing `Phone.cost_price` and `Phone.selling_price` attributes — no new persistent storage, entities, attributes, relationships, or enumerations required. Color-coding thresholds are applied at the UI rendering layer (e.g., conditional CSS classes). No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Phone entity (added F-054 — margin computed per phone in inventory list); Phone.cost_price attribute (added F-054 — used as cost input in margin formula); Phone.selling_price attribute (added F-054 — used as revenue input and denominator in margin formula). |
| 2026-01-28 | F-055    | Processed feature. No new entities derived — F-055 is a frontend SEO/structured data feature (Structured Data JSON-LD for Phone Detail Pages using schema.org Product type). Adds a JSON-LD `<script type="application/ld+json">` tag to phone detail pages containing structured product data for enhanced search engine rich snippets. JSON-LD fields are constructed at runtime from existing entity attributes: `name` from `Brand.name` + `Phone.model` (via Brand → Phone FK), `description` from `Phone.description`, `offers.price` from `Phone.selling_price`, `offers.priceCurrency` (hardcoded or from config), `offers.availability` from `Phone.status` (available → schema.org/InStock), `itemCondition` from `Phone.condition` (new → schema.org/NewCondition, used → schema.org/UsedCondition), `brand.name` from `Brand.name`, and `image` from `PhoneImage.image_url` where `PhoneImage.is_primary=true` (via Phone → PhoneImage relationship). Output must pass Google's Rich Results Test validation. All structured data is computed at runtime in the browser DOM — no new data is persisted to any database entity. No new entities, attributes, relationships, or enumerations added — operates entirely on existing data model elements. Updated featureRefs on: Brand entity (added F-055) and `name` attribute (added F-055 — JSON-LD product name and brand.name); Phone entity (added F-055) and attributes (`model` — JSON-LD name, `description` — JSON-LD description, `selling_price` — JSON-LD offers.price, `condition` — JSON-LD itemCondition mapping, `status` — JSON-LD offers.availability mapping); PhoneImage entity (added F-055) and attributes (`image_url` — JSON-LD image, `is_primary` — selects primary image for JSON-LD); PhoneCondition enumeration and values: `new` (added F-055 — mapped to schema.org/NewCondition), `used` (added F-055 — mapped to schema.org/UsedCondition); PhoneStatus enumeration (added F-055) and `available` value (added F-055 — mapped to schema.org/InStock); Brand → Phone relationship (added F-055 — resolves brand name for JSON-LD product name and brand); Phone → PhoneImage relationship (added F-055 — resolves primary image for JSON-LD image field). |
| 2026-01-28 | F-056    | Processed feature. No new entities derived — F-056 is a frontend UI/theming feature (Dark Mode / Theme Toggle using PrimeNG theming system). Implements a theme toggle button in the application header that switches between light and dark mode. User preference is persisted in `localStorage` (client-side storage) and restored on subsequent visits. On first visit, the system preference is detected via `prefers-color-scheme` CSS media query — if the system is in dark mode, the application defaults to dark theme. When toggled, all PrimeNG components, custom SCSS styles, and text contrast ratios update to the selected theme. Theme switching is entirely client-side — no database queries, no server-side state, no Supabase interaction. **New enumeration added:** ThemeMode (Section 2.6) — a frontend-only enumeration (not stored in the database) with 2 values: `light` (default PrimeNG light theme) and `dark` (PrimeNG dark theme). This follows the same pattern as DashboardDateRange (Section 2.5) — a frontend-only enum documenting UI state options. No new entities, attributes, or relationships added. No existing entity featureRefs updated — feature has no database interaction or data model impact beyond the new frontend-only enumeration. |
| 2026-01-28 | F-057    | Processed feature. No new entities derived — F-057 is a database performance/infrastructure feature (Supabase Database Indexes for Performance). **New section added:** Database Indexes (Section 5) documenting 7 performance indexes across 4 tables: (1) phones table — 4 indexes on `status` (catalog filtering by availability), `brand_id` (brand filter and join optimization), `selling_price` (price sorting and range filtering), `created_at` (newest-first default sort); (2) phone_images table — 1 index on `phone_id` (join optimization for Phone → PhoneImage relationship used in catalog cards and detail gallery); (3) sales table — 1 index on `sale_date` (date range filtering in sales list and dashboard charts monthly aggregation); (4) contact_messages table — 1 index on `is_read` (unread message count badge query). RLS policy analysis documented: application uses role-based RLS checks (`TO anon`/`TO authenticated`) rather than per-row `auth.uid()` column comparisons, so no additional RLS-specific indexes are required; `auth.uid()` caching optimization `(select auth.uid())` further reduces index dependency. Sections renumbered: former Section 5 (Storage Bucket Configuration) → Section 6, former Section 6 (Traceability Matrix) → Section 7, former Section 7 (Change Log) → Section 8. No new entities, attributes, relationships, or enumerations added. Updated featureRefs on: Phone entity (added F-057) and 4 attributes (`status`, `brand_id`, `selling_price`, `created_at` — indexed columns); PhoneImage entity (added F-057) and `phone_id` attribute (indexed for join); Sale entity (added F-057) and `sale_date` attribute (indexed for date filtering); ContactMessage entity (added F-057) and `is_read` attribute (indexed for unread count). |
| 2026-01-28 | F-058    | Processed feature. No new entities derived — F-058 is a security/validation feature (Input Sanitization and XSS Prevention). **Constraint refinements on existing attributes across 7 entities:** added `maxlength` constraints and plain-text storage annotations to all user-input VARCHAR and TEXT fields to enforce input length limits and prevent XSS. Angular's built-in DomSanitizer handles template binding sanitization; `bypassSecurityTrust*` methods are prohibited unless absolutely necessary and documented. Server-side validation enforced via Supabase RLS and PostgreSQL constraints (CHECK constraints for maxlength). **Entities updated:** (1) Brand — `name` maxlength 100; (2) Phone — `model` maxlength 150, `description` maxlength 5000, `color` maxlength 50, `imei` maxlength 20, `notes` maxlength 2000 (all plain text, no HTML interpretation); (3) Supplier — `name` maxlength 200, `contact_person` maxlength 200, `contact_email` maxlength 255, `contact_phone` maxlength 30, `address` maxlength 1000, `notes` maxlength 2000 (all plain text, no HTML interpretation); (4) PurchaseOrder — `notes` maxlength 2000 (plain text); (5) PurchaseOrderItem — `brand` maxlength 100, `model` maxlength 150 (plain text); (6) Sale — `buyer_name` maxlength 200, `buyer_phone` maxlength 30, `buyer_email` maxlength 255, `notes` maxlength 2000 (all plain text); (7) ContactMessage — `name` maxlength 200, `email` maxlength 255, `phone` maxlength 30, `subject` maxlength 300, `message` maxlength 5000 (plain text, explicit `<script>` tag execution prevention in admin messages view, rendered with proper escaping). No new entities, attributes, relationships, or enumerations added. Updated featureRefs on all 7 entities and their affected text/varchar attributes. |
| 2026-01-28 | F-059    | Processed feature. No new entities derived — F-059 is a public-facing UI/static page feature (404 Not Found Page). Implements a user-friendly 404 page displayed for unknown routes, showing a clear "Page Not Found" message with a link/button to return to the home catalog page. Uses the public layout shell (header and footer) from F-007. The 404/wildcard route is already defined in F-006. The page is purely presentational with static content — no database queries, no entity attribute references, no data persistence. No new entities, attributes, relationships, or enumerations added. No existing entity featureRefs updated — feature has no database interaction or data model impact. |
| 2026-01-28 | F-060    | Processed feature. No new entities derived — F-060 is an infrastructure/configuration feature (Environment Configuration Management for Angular development and production builds). Sets up Angular environment configuration files: `environment.ts` (development Supabase URL and anon key), `environment.prod.ts` (production Supabase URL and anon key), and `environment.example.ts` (template for new developer onboarding). Build configurations in `angular.json` use `fileReplacements` to swap environment files for production builds. Enforces that no Supabase service_role key or admin credentials are included in client-side bundles — only the public anon key is exposed. All configuration values are static build-time TypeScript constants, not persisted to any database entity. No new entities, attributes, relationships, or enumerations added. No existing entity featureRefs updated — feature has no database interaction or data model impact. |
