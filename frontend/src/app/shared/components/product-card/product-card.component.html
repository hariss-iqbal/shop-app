<div class="product-card-new" (click)="navigateToDetail()">
  <!-- Image Area -->
  <div class="card-image-area">
    <!-- Badge (top-left) -->
    @if (showBadges()) {
      @if (productExtras().isFeatured) {
        <span class="card-badge badge-featured">FEATURED</span>
      } @else if (productExtras().hasDiscount && productExtras().discountPercent >= 15) {
        <span class="card-badge badge-sale">{{ productExtras().discountPercent }}% OFF</span>
      } @else if (productExtras().isNewArrival) {
        <span class="card-badge badge-new">NEW ARRIVAL</span>
      } @else if (product().condition !== 'new') {
        <span class="card-badge badge-preowned">PRE-OWNED</span>
      }
    }

    <!-- Product Image -->
    @if (product().primaryImageUrl) {
      <img
        [src]="cardImageUrl()"
        [srcset]="cardSrcSet()"
        sizes="(max-width: 768px) 50vw, (max-width: 1200px) 33vw, 25vw"
        [alt]="product().brandName + ' ' + product().model"
        width="200"
        height="256"
        [loading]="eagerLoad() ? 'eager' : 'lazy'"
        [appBlurUpImage]="product().primaryImageUrl!"
        [blurUpDisabled]="eagerLoad()"
        (error)="onImageError($event)"
      />
    } @else {
      <div class="no-image-placeholder">
        <i class="pi pi-image" aria-hidden="true"></i>
        <span>No image</span>
      </div>
    }

    <!-- PTA Badge (bottom-right) -->
    @if (product().ptaStatus) {
      <span class="pta-overlay"
            [class.pta-overlay-approved]="product().ptaStatus === 'pta_approved'"
            [class.pta-overlay-non]="product().ptaStatus === 'non_pta'">
        @if (product().ptaStatus === 'pta_approved') {
          <i class="pi pi-verified" style="font-size: 0.6rem;"></i> PTA
        } @else {
          <i class="pi pi-mobile" style="font-size: 0.6rem;"></i> NON PTA
        }
      </span>
    }

    <!-- Compare Button (hover overlay) -->
    <button class="card-compare-btn" (click)="toggleCompare($event)" aria-label="Compare this product">
      <i class="pi pi-arrows-h"></i> Compare
    </button>
  </div>

  <!-- Info Section -->
  <div class="card-info">
    <span class="card-brand">{{ product().brandName }}</span>
    <h3 class="card-model">{{ product().model }}</h3>

    <!-- Chips: storage + color -->
    <div class="card-chips">
      @if (product().storageGb) {
        <span class="card-chip">{{ product().storageGb }}GB</span>
      }
      @if (product().color) {
        <span class="card-chip">{{ product().color }}</span>
      }
    </div>

    <!-- Price Row -->
    <div class="card-price-row">
      <div class="card-price-group">
        <span class="card-price" [class.discount-price]="showDiscount() && productExtras().hasDiscount">
          {{ product().sellingPrice | appCurrency }}
        </span>
        @if (showDiscount() && productExtras().hasDiscount && productExtras().originalPrice) {
          <span class="card-original-price">{{ productExtras().originalPrice | appCurrency }}</span>
        }
      </div>
    </div>
  </div>
</div>
