<div class="min-h-screen flex flex-column">
  <!-- F-042: Skip Link for keyboard users -->
  <app-skip-link targetId="main-content" />

  <!-- Redesigned Header: Light with backdrop blur -->
  <header class="header-redesign sticky top-0" style="z-index: 50;">
    <!-- Main Navigation -->
    <nav class="flex align-items-center justify-content-between px-3 py-3 sm:px-4 lg:px-6 gap-3"
         aria-label="Main navigation">
      <!-- Logo/Brand -->
      <a routerLink="/"
         class="flex align-items-center gap-2 text-xl font-bold no-underline flex-shrink-0 text-color"
         [attr.aria-label]="shopName() + ' - Home'">
        <div class="header-logo-icon">
          <i class="pi pi-mobile text-white" style="font-size: 1.1rem;" aria-hidden="true"></i>
        </div>
        <span class="hidden sm:inline">{{ shopName() }}</span>
      </a>

      <!-- Desktop Nav Links -->
      <div class="hidden lg:flex align-items-center gap-1" role="menubar">
        <a routerLink="/"
           routerLinkActive="nav-link-active"
           [routerLinkActiveOptions]="{ exact: true }"
           class="nav-link-pill"
           role="menuitem"
           aria-label="Home page">
          Home
        </a>
        <a class="nav-link-pill" role="menuitem" style="cursor: default;">
          Smartphones
        </a>
        <a class="nav-link-pill" role="menuitem" style="cursor: default;">
          Tablets
        </a>
        <a class="nav-link-pill" role="menuitem" style="cursor: default;">
          Accessories
        </a>
      </div>

      <!-- Search Bar (Desktop) -->
      <div class="hidden lg:flex flex-grow-1 max-w-30rem mx-4">
        <form (ngSubmit)="performSearch()" class="w-full">
          <p-iconfield iconPosition="left" styleClass="w-full">
            <p-inputicon styleClass="pi pi-search" />
            <input
              pInputText
              [(ngModel)]="searchQuery"
              name="search"
              class="w-full header-search-input"
              placeholder="Search products..."
              aria-label="Search products"
            />
          </p-iconfield>
        </form>
      </div>

      <!-- Action Icons (Desktop) -->
      <div class="hidden lg:flex align-items-center gap-1">
        <!-- F-056: Theme Toggle -->
        <p-button
          [icon]="themeService.isDark() ? 'pi pi-sun' : 'pi pi-moon'"
          [text]="true"
          [rounded]="true"
          (onClick)="themeService.toggleTheme()"
          [pTooltip]="themeService.isDark() ? 'Switch to light mode' : 'Switch to dark mode'"
          tooltipPosition="bottom"
          [ariaLabel]="themeService.isDark() ? 'Switch to light mode' : 'Switch to dark mode'"
        />
        <!-- Compare Button -->
        <a routerLink="/compare" class="no-underline relative" aria-label="Compare products">
          <p-button
            icon="pi pi-arrows-h"
            [text]="true"
            [rounded]="true"
            pTooltip="Compare products"
            tooltipPosition="bottom"
          />
          @if (comparisonService.count() > 0) {
            <span class="comparison-badge">{{ comparisonService.count() }}</span>
          }
        </a>
      </div>

      <!-- Mobile Actions -->
      <div class="flex align-items-center gap-1 lg:hidden">
        <!-- Mobile Search Toggle -->
        <p-button
          icon="pi pi-search"
          [text]="true"
          [rounded]="true"
          (onClick)="mobileSearchOpen.set(!mobileSearchOpen())"
          ariaLabel="Toggle search"
        />
        <!-- F-056: Mobile Theme Toggle -->
        <p-button
          [icon]="themeService.isDark() ? 'pi pi-sun' : 'pi pi-moon'"
          [text]="true"
          [rounded]="true"
          (onClick)="themeService.toggleTheme()"
          [ariaLabel]="themeService.isDark() ? 'Switch to light mode' : 'Switch to dark mode'"
        />
        <!-- Compare Icon (Mobile) -->
        <a routerLink="/compare" class="no-underline relative">
          <p-button
            icon="pi pi-arrows-h"
            [text]="true"
            [rounded]="true"
            ariaLabel="Compare products"
          />
          @if (comparisonService.count() > 0) {
            <span class="comparison-badge">{{ comparisonService.count() }}</span>
          }
        </a>
        <!-- Menu Button -->
        <p-button icon="pi pi-bars"
                  [text]="true"
                  [rounded]="true"
                  (onClick)="mobileMenuOpen.set(true)"
                  [attr.aria-label]="'Open navigation menu'"
                  [attr.aria-expanded]="mobileMenuOpen()"
                  aria-controls="mobile-nav-sidebar" />
      </div>
    </nav>

    <!-- Mobile Search Bar (Expandable) -->
    @if (mobileSearchOpen()) {
      <div class="lg:hidden px-3 pb-3">
        <form (ngSubmit)="performSearch(); mobileSearchOpen.set(false)" class="w-full">
          <p-iconfield iconPosition="left" styleClass="w-full">
            <p-inputicon styleClass="pi pi-search" />
            <input
              pInputText
              [(ngModel)]="searchQuery"
              name="mobileSearch"
              class="w-full"
              placeholder="Search products..."
              aria-label="Search products"
            />
          </p-iconfield>
        </form>
      </div>
    }
  </header>

  <!-- Mobile Navigation Sidebar -->
  <p-drawer [(visible)]="mobileMenuVisible"
            position="right"
            [modal]="true"
            styleClass="w-18rem"
            id="mobile-nav-sidebar"
            ariaCloseLabel="Close navigation menu">
    <ng-template pTemplate="header">
      <div class="flex align-items-center gap-2">
        <div class="header-logo-icon" style="width: 28px; height: 28px;">
          <i class="pi pi-mobile text-white" style="font-size: 0.85rem;" aria-hidden="true"></i>
        </div>
        <span class="font-bold text-lg">{{ shopName() }}</span>
      </div>
    </ng-template>

    <nav class="flex flex-column gap-2 mt-3" aria-label="Mobile navigation">
      <a routerLink="/"
         routerLinkActive="bg-primary-100 text-primary"
         [routerLinkActiveOptions]="{ exact: true }"
         class="flex align-items-center gap-3 p-3 border-round text-color no-underline transition-colors transition-duration-200"
         (click)="closeMobileMenu()"
         role="menuitem"
         aria-label="Home page">
        <i class="pi pi-home text-xl" aria-hidden="true"></i>
        <span class="font-medium">Home</span>
      </a>
      <a routerLink="/about"
         routerLinkActive="bg-primary-100 text-primary"
         class="flex align-items-center gap-3 p-3 border-round text-color no-underline transition-colors transition-duration-200"
         (click)="closeMobileMenu()"
         role="menuitem"
         aria-label="Learn about our shop">
        <i class="pi pi-info-circle text-xl" aria-hidden="true"></i>
        <span class="font-medium">About</span>
      </a>
      <a routerLink="/contact"
         routerLinkActive="bg-primary-100 text-primary"
         class="flex align-items-center gap-3 p-3 border-round text-color no-underline transition-colors transition-duration-200"
         (click)="closeMobileMenu()"
         role="menuitem"
         aria-label="Contact us">
        <i class="pi pi-envelope text-xl" aria-hidden="true"></i>
        <span class="font-medium">Contact</span>
      </a>

      <div class="border-top-1 surface-border my-3"></div>

      <a [href]="'https://wa.me/' + whatsappNumber()"
         target="_blank"
         rel="noopener noreferrer"
         class="flex align-items-center gap-3 p-3 border-round text-color no-underline transition-colors transition-duration-200"
         (click)="closeMobileMenu()"
         role="menuitem"
         aria-label="Chat with us on WhatsApp (opens in new tab)">
        <i class="pi pi-whatsapp text-xl" aria-hidden="true"></i>
        <span class="font-medium">WhatsApp</span>
      </a>
    </nav>
  </p-drawer>

  <!-- Main Content -->
  <main id="main-content" class="flex-grow-1 px-3 py-4 sm:px-4 lg:px-6" role="main">
    <router-outlet />
  </main>

  <!-- Redesigned Footer: 4-column layout -->
  <footer class="footer-section" role="contentinfo">
    <!-- Main Footer Content -->
    <div class="footer-main">
      <div class="grid px-3 py-5 sm:px-4 lg:px-6">
        <!-- Column 1: Store Info -->
        <div class="col-12 md:col-6 lg:col-3 mb-4 lg:mb-0">
          <div class="flex align-items-center gap-2 mb-4">
            <div class="footer-logo">
              <i class="pi pi-mobile text-xl text-white" aria-hidden="true"></i>
            </div>
            <span class="font-bold text-xl text-color">{{ shopName() }}</span>
          </div>
          <p class="text-color-secondary line-height-3 mt-0 mb-4" style="font-size: 0.875rem;">
            Your trusted destination for quality mobile products. We offer new, used, and open box
            devices at competitive prices with a 30-day quality guarantee.
          </p>
          <!-- Social Media Icons -->
          <div class="flex align-items-center gap-2">
            <a [href]="facebookUrl()"
               class="social-icon"
               aria-label="Visit our Facebook page"
               rel="noopener noreferrer">
              <i class="pi pi-facebook" aria-hidden="true"></i>
            </a>
            <a [href]="instagramUrl()"
               class="social-icon"
               aria-label="Visit our Instagram page"
               rel="noopener noreferrer">
              <i class="pi pi-instagram" aria-hidden="true"></i>
            </a>
            <a [href]="twitterUrl()"
               class="social-icon"
               aria-label="Visit our Twitter page"
               rel="noopener noreferrer">
              <i class="pi pi-twitter" aria-hidden="true"></i>
            </a>
            <a [href]="'https://wa.me/' + whatsappNumber()"
               class="social-icon"
               target="_blank"
               rel="noopener noreferrer"
               aria-label="Chat with us on WhatsApp (opens in new tab)">
              <i class="pi pi-whatsapp" aria-hidden="true"></i>
            </a>
          </div>
        </div>

        <!-- Column 2: Shop Links -->
        <div class="col-12 md:col-6 lg:col-2 mb-4 lg:mb-0">
          <h3 class="font-semibold mb-3 mt-0 text-color" style="font-size: 0.9375rem;">Shop</h3>
          <nav aria-label="Footer shop navigation">
            <ul class="list-none p-0 m-0">
              <li class="mb-2">
                <a routerLink="/"
                   class="footer-link"
                   aria-label="Home page">
                  Home
                </a>
              </li>
              <li class="mb-2">
                <a routerLink="/"
                   class="footer-link"
                   aria-label="Browse product catalog">
                  Catalog
                </a>
              </li>
              <li class="mb-2">
                <a routerLink="/about"
                   class="footer-link"
                   aria-label="Learn about our shop">
                  About Us
                </a>
              </li>
              <li class="mb-2">
                <a routerLink="/contact"
                   class="footer-link"
                   aria-label="Contact us">
                  Contact
                </a>
              </li>
            </ul>
          </nav>
        </div>

        <!-- Column 3: Support Links -->
        <div class="col-12 md:col-6 lg:col-2 mb-4 lg:mb-0">
          <h3 class="font-semibold mb-3 mt-0 text-color" style="font-size: 0.9375rem;">Support</h3>
          <nav aria-label="Support links">
            <ul class="list-none p-0 m-0">
              <li class="mb-2">
                <a routerLink="/contact"
                   class="footer-link"
                   aria-label="FAQ">
                  FAQ
                </a>
              </li>
              <li class="mb-2">
                <a routerLink="/about"
                   class="footer-link"
                   aria-label="Warranty information">
                  Warranty
                </a>
              </li>
              <li class="mb-2">
                <a routerLink="/contact"
                   class="footer-link"
                   aria-label="Returns policy">
                  Returns
                </a>
              </li>
              <li class="mb-2">
                <a routerLink="/contact"
                   class="footer-link"
                   aria-label="Contact support">
                  Contact
                </a>
              </li>
            </ul>
          </nav>
        </div>

        <!-- Column 4: Newsletter (visual placeholder) -->
        <div class="col-12 md:col-6 lg:col-5">
          <h3 class="font-semibold mb-3 mt-0 text-color" style="font-size: 0.9375rem;">Newsletter</h3>
          <p class="text-color-secondary line-height-3 mt-0 mb-3" style="font-size: 0.875rem;">
            Stay updated with our latest arrivals and exclusive deals. Subscribe to our newsletter.
          </p>
          <div class="flex gap-2">
            <input
              pInputText
              type="email"
              placeholder="Enter your email"
              class="flex-grow-1"
              style="border-radius: 8px;"
              disabled
            />
            <button
              class="newsletter-join-btn"
              disabled
            >
              Join
            </button>
          </div>
          <span class="text-color-secondary text-xs mt-2 block">Coming soon</span>
        </div>
      </div>
    </div>

    <!-- Copyright Bar -->
    <div class="footer-bottom">
      <div class="flex flex-column md:flex-row align-items-center justify-content-between gap-2 px-3 py-3 sm:px-4 lg:px-6">
        <p class="m-0 text-color-secondary text-sm">
          &copy; {{ currentYear }} {{ shopName() }}. All rights reserved.
        </p>
        <div class="flex align-items-center gap-4 text-sm">
          <a routerLink="/about" class="footer-link text-sm" aria-label="Privacy Policy">
            Privacy Policy
          </a>
          <a routerLink="/about" class="footer-link text-sm" aria-label="Terms of Service">
            Terms of Service
          </a>
        </div>
      </div>
    </div>
  </footer>

  <!-- WhatsApp FAB -->
  @if (whatsappNumber()) {
    <a class="whatsapp-fab" [href]="'https://wa.me/' + whatsappNumber()" target="_blank" rel="noopener noreferrer" aria-label="Chat with us on WhatsApp">
      <i class="pi pi-whatsapp"></i>
    </a>
  }

  <!-- Back to Top Button -->
  <app-back-to-top />
</div>
